From 837e48022d07856741c71e98b91a8a0573f25bbd Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Fri, 19 Feb 2010 13:47:15 +0800
Subject: [PATCH 01/13] moved handler map to .cc

---
 libpdfdoc/include/graphics/GraphicsState.hh |   11 +-------
 libpdfdoc/src/graphics/GraphicsState.cc     |   31 +++++++++++++++++++-------
 2 files changed, 24 insertions(+), 18 deletions(-)

diff --git a/libpdfdoc/include/graphics/GraphicsState.hh b/libpdfdoc/include/graphics/GraphicsState.hh
index 4903801..8749fec 100644
--- a/libpdfdoc/include/graphics/GraphicsState.hh
+++ b/libpdfdoc/include/graphics/GraphicsState.hh
@@ -72,15 +72,8 @@ public :
 	bool operator==( const GraphicsState& gs ) const ;
 
 private :
-    /// command handler
-	typedef bool (GraphicsState::*Handler)(
-		Object			*args,
-		std::size_t		count,
-		Resources		*res ) ;
-	typedef std::map<Token, Handler>	HandlerMap ;
-
-	static const HandlerMap::value_type	m_handler_map_values[] ;
-	static const HandlerMap				m_handler_map ;
+	struct HandlerMap ;
+	friend struct HandlerMap ;
 
 	// text state command handlers
 	bool OnTf( Object* args, std::size_t count, Resources *res ) ;
diff --git a/libpdfdoc/src/graphics/GraphicsState.cc b/libpdfdoc/src/graphics/GraphicsState.cc
index 4d94c84..47a2337 100644
--- a/libpdfdoc/src/graphics/GraphicsState.cc
+++ b/libpdfdoc/src/graphics/GraphicsState.cc
@@ -39,17 +39,30 @@
 
 namespace pdf {
 
-const GraphicsState::HandlerMap::value_type
-	GraphicsState::m_handler_map_values[] =
+struct GraphicsState::HandlerMap
+{
+	/// command handler
+	typedef bool (GraphicsState::*Handler)(
+		Object			*args,
+		std::size_t		count,
+		Resources		*res ) ;
+	typedef std::map<Token, Handler>	Map ;
+
+	static const Map::value_type	m_val[] ;
+	static const Map				m_map ;
+} ;
+
+const GraphicsState::HandlerMap::Map::value_type
+	GraphicsState::HandlerMap::m_val[] =
 {
 	// text state commands
 	std::make_pair( "Tf",	&GraphicsState::OnTf ),
 	std::make_pair( "TL",	&GraphicsState::OnTL ),
 } ;
 
-const GraphicsState::HandlerMap GraphicsState::m_handler_map(
-    Begin( GraphicsState::m_handler_map_values ),
-    End( GraphicsState::m_handler_map_values ) ) ;
+const GraphicsState::HandlerMap::Map GraphicsState::HandlerMap::m_map(
+    Begin( GraphicsState::HandlerMap::m_val ),
+    End( GraphicsState::HandlerMap::m_val ) ) ;
 
 /**	constructor
 	
@@ -87,8 +100,8 @@ bool GraphicsState::OnCommand(
 	std::size_t		count,
 	Resources		*res )
 {
-	HandlerMap::const_iterator i = m_handler_map.find( cmd ) ;
-	if ( i != m_handler_map.end() )
+	HandlerMap::Map::const_iterator i = HandlerMap::m_map.find( cmd ) ;
+	if ( i != HandlerMap::m_map.end() )
 		return (this->*(i->second))( args, count, res ) ;
 
 	return false ;
@@ -96,8 +109,8 @@ bool GraphicsState::OnCommand(
 
 bool GraphicsState::IsGSCommand( const Token& cmd )
 {
-	HandlerMap::const_iterator i = m_handler_map.find( cmd ) ;
-	return i != m_handler_map.end() ;
+	HandlerMap::Map::const_iterator i = HandlerMap::m_map.find( cmd ) ;
+	return i != HandlerMap::m_map.end() ;
 }
 
 bool GraphicsState::OnTf( Object* args, std::size_t count, Resources *res )
-- 
1.6.6


From 4ad2b24a3add855c899845257cb4a2f630b520e0 Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Fri, 19 Feb 2010 18:31:08 +0800
Subject: [PATCH 02/13] msvc compiles fine without friends

---
 libpdfdoc/include/graphics/GraphicsState.hh |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/libpdfdoc/include/graphics/GraphicsState.hh b/libpdfdoc/include/graphics/GraphicsState.hh
index 8749fec..b4c01f9 100644
--- a/libpdfdoc/include/graphics/GraphicsState.hh
+++ b/libpdfdoc/include/graphics/GraphicsState.hh
@@ -73,7 +73,6 @@ public :
 
 private :
 	struct HandlerMap ;
-	friend struct HandlerMap ;
 
 	// text state command handlers
 	bool OnTf( Object* args, std::size_t count, Resources *res ) ;
-- 
1.6.6


From 5e293a7ef8f34b6ed96fc8d720b95a6a5301c056 Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Fri, 19 Feb 2010 15:30:26 +0000
Subject: [PATCH 03/13] fixed compile problems in gcc

---
 libpdfdoc/include/graphics/GraphicsState.hh |    3 ++
 libpdfdoc/include/graphics/TextLine.hh      |    4 +-
 libpdfdoc/src/graphics/GraphicsState.cc     |   10 ++++++++
 libpdfdoc/src/graphics/RealText.cc          |    8 +-----
 libpdfdoc/src/graphics/RealText.hh          |    1 -
 libpdfdoc/src/graphics/TextLine.cc          |    8 +++---
 libpdfdoc/src/page/RealPage.cc              |    2 +-
 libpdfdoc/src/page/RealPage.hh              |    2 +-
 libpdfdoc/test/graphics/RealTextTest.cc     |   33 +++++++++++++++-----------
 pdfedit/src/GlyphGroup.cc                   |    2 +-
 pdfedit/src/GlyphGroup.hh                   |    8 +++---
 pdfedit/src/MainWnd.cc                      |    6 -----
 12 files changed, 46 insertions(+), 41 deletions(-)

diff --git a/libpdfdoc/include/graphics/GraphicsState.hh b/libpdfdoc/include/graphics/GraphicsState.hh
index b4c01f9..4002ea7 100644
--- a/libpdfdoc/include/graphics/GraphicsState.hh
+++ b/libpdfdoc/include/graphics/GraphicsState.hh
@@ -70,6 +70,9 @@ public :
 	static bool IsGSCommand( const Token& cmd ) ;
 
 	bool operator==( const GraphicsState& gs ) const ;
+	bool operator!=( const GraphicsState& gs ) const ;
+
+	friend std::ostream& operator<<(std::ostream& os, const GraphicsState& gs) ;
 
 private :
 	struct HandlerMap ;
diff --git a/libpdfdoc/include/graphics/TextLine.hh b/libpdfdoc/include/graphics/TextLine.hh
index 5588712..2d415c7 100644
--- a/libpdfdoc/include/graphics/TextLine.hh
+++ b/libpdfdoc/include/graphics/TextLine.hh
@@ -78,8 +78,8 @@ public :
 	bool operator!=( const TextLine& rhs ) const ;
 
 	/// Returns the text state of the text line.
-	const TextState& Format() const ;
-	void SetFormat( const TextState& fmt ) ;
+	const GraphicsState& Format() const ;
+	void SetFormat( const GraphicsState& fmt ) ;
 
 	///	Returns the unicode string of the text line.
 	const std::wstring& Text() const ;
diff --git a/libpdfdoc/src/graphics/GraphicsState.cc b/libpdfdoc/src/graphics/GraphicsState.cc
index 47a2337..8ec6232 100644
--- a/libpdfdoc/src/graphics/GraphicsState.cc
+++ b/libpdfdoc/src/graphics/GraphicsState.cc
@@ -159,4 +159,14 @@ bool GraphicsState::operator==( const GraphicsState& gs ) const
 	return m_text == gs.m_text ;
 }
 
+bool GraphicsState::operator!=( const GraphicsState& gs ) const
+{
+	return !operator==( gs ) ;
+}
+
+std::ostream& operator<<( std::ostream& os, const GraphicsState& gs )
+{
+	return os << gs.m_text ;
+}
+
 } // end of namespace
diff --git a/libpdfdoc/src/graphics/RealText.cc b/libpdfdoc/src/graphics/RealText.cc
index a04ad81..45e86f7 100644
--- a/libpdfdoc/src/graphics/RealText.cc
+++ b/libpdfdoc/src/graphics/RealText.cc
@@ -72,12 +72,6 @@ RealText::RealText( const GraphicsState& gs )
 {
 }
 
-RealText::RealText( const TextState& ts )
-	: m_lines( 1, TextLine( GraphicsState( ts ), Matrix() ) ),
-	  m_state( GraphicsState( ts ) )
-{
-}
-
 RealText::iterator RealText::begin()
 {
 	return m_lines.begin( ) ;
@@ -150,7 +144,7 @@ void RealText::OnCommand(
 		if ( current.IsEmpty() || is_changed )
 		{
 			if ( current.IsEmpty() )
-				current.SetFormat( m_state.GetTextState() ) ;
+				current.SetFormat( m_state ) ;
 			else
 				m_lines.push_back( TextLine( m_state, m_text_mat ) ) ;
 		}
diff --git a/libpdfdoc/src/graphics/RealText.hh b/libpdfdoc/src/graphics/RealText.hh
index 63386ac..d5a4533 100644
--- a/libpdfdoc/src/graphics/RealText.hh
+++ b/libpdfdoc/src/graphics/RealText.hh
@@ -47,7 +47,6 @@ class RealText : public Text
 {
 public :
 	explicit RealText( const GraphicsState& ts = GraphicsState() ) ;
-	explicit RealText( const TextState& ts ) ;
 
 	void OnCommand(
 		const Token& 	cmd,
diff --git a/libpdfdoc/src/graphics/TextLine.cc b/libpdfdoc/src/graphics/TextLine.cc
index e69eb58..5f87dbd 100644
--- a/libpdfdoc/src/graphics/TextLine.cc
+++ b/libpdfdoc/src/graphics/TextLine.cc
@@ -157,14 +157,14 @@ bool TextLine::operator!=( const TextLine& rhs ) const
 	return !operator==( rhs ) ;
 }
 
-const TextState& TextLine::Format() const
+const GraphicsState& TextLine::Format() const
 {
-	return m_state.GetTextState() ;
+	return m_state ;
 }
 
-void TextLine::SetFormat( const TextState& fmt )
+void TextLine::SetFormat( const GraphicsState& fmt )
 {
-	m_state.GetTextState() = fmt ;
+	m_state = fmt ;
 }
 
 const std::wstring& TextLine::Text() const
diff --git a/libpdfdoc/src/page/RealPage.cc b/libpdfdoc/src/page/RealPage.cc
index 9e5ca7c..a763c12 100644
--- a/libpdfdoc/src/page/RealPage.cc
+++ b/libpdfdoc/src/page/RealPage.cc
@@ -163,7 +163,7 @@ PageTree* RealPage::Parent( )
 	return m_pinfo.Parent( ) ;
 }
 
-PageNode* RealPage::GetLeaf( std::size_t index )
+RealPage* RealPage::GetLeaf( std::size_t index )
 {
 	// we are a leaf node. we have no children but ourselves.
 	return index == 0 ? this : 0 ;
diff --git a/libpdfdoc/src/page/RealPage.hh b/libpdfdoc/src/page/RealPage.hh
index a3fdbb0..1cd1a9b 100644
--- a/libpdfdoc/src/page/RealPage.hh
+++ b/libpdfdoc/src/page/RealPage.hh
@@ -64,7 +64,7 @@ public :
 	std::size_t Count( ) const ;
 	PageTree* Parent( ) ;
 	
-	PageNode* GetLeaf( std::size_t index ) ;
+	RealPage* GetLeaf( std::size_t index ) ;
 	
 	RealResources* GetResource( ) ;
 	const RealResources* GetResource( ) const ;
diff --git a/libpdfdoc/test/graphics/RealTextTest.cc b/libpdfdoc/test/graphics/RealTextTest.cc
index c11407d..c31f4e4 100644
--- a/libpdfdoc/test/graphics/RealTextTest.cc
+++ b/libpdfdoc/test/graphics/RealTextTest.cc
@@ -53,10 +53,11 @@ void RealTextTest::TestTdCmd( )
 	
 	TextState ts ;
 	ts.SetFont( 12.0, &font ) ;
+	GraphicsState gs( ts ) ;
 
-	RealText t( ts ) ;
+	RealText t( gs ) ;
 	PDFUT_ASSERT_EQUAL( t.Count(), 1U ) ;
-	PDFUT_ASSERT_EQUAL( t.front().Format(), ts ) ;
+	PDFUT_ASSERT_EQUAL( t.front().Format(), gs ) ;
 	PDFUT_ASSERT_EQUAL( t.front().Transform(), Matrix() ) ;
 
 	// action: translate to 100,200
@@ -66,7 +67,7 @@ void RealTextTest::TestTdCmd( )
 	
 	// expected: no new text line is added. current matrix translated
 	PDFUT_ASSERT_EQUAL( t.Count(), 1U ) ;
-	PDFUT_ASSERT_EQUAL( t.front().Format(), ts ) ;
+	PDFUT_ASSERT_EQUAL( t.front().Format(), gs ) ;
 	PDFUT_ASSERT_EQUAL( t.front().Transform(), Matrix(1,0,0,1,100,200) ) ;
 
 	// action: move another 300,900
@@ -76,11 +77,11 @@ void RealTextTest::TestTdCmd( )
 	
 	// expected: the two translation is combined
 	PDFUT_ASSERT_EQUAL( t.Count(), 1U ) ;
-	PDFUT_ASSERT_EQUAL( t.front().Format(), ts ) ;
+	PDFUT_ASSERT_EQUAL( t.front().Format(), gs ) ;
 	PDFUT_ASSERT_EQUAL( t.front().Transform(), Matrix(1,0,0,1,400,1100) ) ;
 	
-	RealText exp( ts ) ;
-	exp.back() = TextLine( (GraphicsState(ts)), (Matrix(1,0,0,1,400,1100)) ) ;
+	RealText exp( gs ) ;
+	exp.back() = TextLine( gs, Matrix(1,0,0,1,400,1100) ) ;
 	PDFUT_ASSERT_EQUAL( t, exp ) ;
 }
 
@@ -91,8 +92,9 @@ void RealTextTest::TestTj( )
 	Name fname = res.AddFont( &font ) ;
 	
 	TextState ts( 12.0, &font ) ;
+	GraphicsState gs( ts ) ;
 
-	RealText t( ts ) ;
+	RealText t( gs ) ;
 	
 	// action: display a string "abc"
 	Object	args[]	= { "abc" } ;
@@ -100,7 +102,7 @@ void RealTextTest::TestTj( )
 	t.OnCommand( cmd, args, Count(args), &res ) ;
 	
 	PDFUT_ASSERT_EQUAL( t.Count(), 1U ) ;
-	PDFUT_ASSERT_EQUAL( t.front().Format(), ts ) ;
+	PDFUT_ASSERT_EQUAL( t.front().Format(), gs ) ;
 	PDFUT_ASSERT_EQUAL( t.front().Transform(), Matrix() ) ;
 	CPPUNIT_ASSERT( t.front().Text() == L"abc" ) ;
 	PDFUT_ASSERT_EQUAL( t.front().Width(), 18 ) ;
@@ -112,13 +114,14 @@ void RealTextTest::TestTj( )
 	t.OnCommand( cmd2, args2, Count(args2), &res ) ;
 	
 	PDFUT_ASSERT_EQUAL( t.Count(), 1U ) ;
-	PDFUT_ASSERT_EQUAL( t.back().Format(), ts ) ;
+	PDFUT_ASSERT_EQUAL( t.back().Format(), gs ) ;
 		
 	CPPUNIT_ASSERT( t.back().Text() == L"abcabc" ) ;
 	PDFUT_ASSERT_EQUAL( t.back().Width(), 36 ) ;
 	
 	// double font size
 	TextState ts2x( 24.0, &font ) ;
+	GraphicsState gs2x( ts2x ) ;
 	Object	args3[]	= { fname, 24.0 } ;
 	Token	cmd3( "Tf" ) ;
 	t.OnCommand( cmd3, args3, Count(args3), &res ) ;
@@ -129,7 +132,7 @@ void RealTextTest::TestTj( )
 	t.OnCommand( cmd4, args4, Count(args4), &res ) ;
 
 	PDFUT_ASSERT_EQUAL( t.Count(), 2U ) ;
-	PDFUT_ASSERT_EQUAL( t.back().Format(), ts2x ) ;
+	PDFUT_ASSERT_EQUAL( t.back().Format(), gs2x ) ;
 	PDFUT_ASSERT_EQUAL( 
 		t.back().Transform(),
 		Matrix(1,0,0,1, 36.0, 0 ) ) ;
@@ -142,8 +145,9 @@ void RealTextTest::TestTJ( )
 	Name fname = res.AddFont( &font ) ;
 	
 	TextState ts( 12.0, &font ) ;
+	GraphicsState gs( ts ) ;
 
-	RealText t( ts ) ;
+	RealText t( gs ) ;
 	
 	// action: display a string "abc"
 	Object	tj_ops[] = { "abc", -2000.0, "cde" } ;
@@ -153,7 +157,7 @@ void RealTextTest::TestTJ( )
 	t.OnCommand( cmd, args, Count(args), &res ) ;
 
 	PDFUT_ASSERT_EQUAL( t.Count(), 1U ) ;
-	PDFUT_ASSERT_EQUAL( t.front().Format(), ts ) ;
+	PDFUT_ASSERT_EQUAL( t.front().Format(), gs ) ;
 	
 	const TextLine& line = t.front() ;
 	PDFUT_ASSERT_EQUAL( line.Width(), 60.0 ) ;
@@ -182,7 +186,8 @@ void RealTextTest::TestTjx2( )
 	Name fname = res.AddFont( &font ) ;
 	
 	TextState ts( 12.0, &font ) ;
-	RealText t( ts ) ;
+	GraphicsState gs( ts ) ;
+	RealText t( gs ) ;
 
 	// action: display a string "111"
 	Object	args[]	= { "111" } ;
@@ -195,7 +200,7 @@ void RealTextTest::TestTjx2( )
 	t.OnCommand( cmd2, args2, Count(args2), &res ) ;
 
 	PDFUT_ASSERT_EQUAL( t.Count(), 1U ) ;
-	PDFUT_ASSERT_EQUAL( t.front().Format(), ts ) ;
+	PDFUT_ASSERT_EQUAL( t.front().Format(), gs ) ;
 	PDFUT_ASSERT_EQUAL( t.front().Transform(), Matrix() ) ;
 	CPPUNIT_ASSERT( t.front().Text() == L"111222" ) ;
 }
diff --git a/pdfedit/src/GlyphGroup.cc b/pdfedit/src/GlyphGroup.cc
index b5d9ae5..6391bf3 100644
--- a/pdfedit/src/GlyphGroup.cc
+++ b/pdfedit/src/GlyphGroup.cc
@@ -71,7 +71,7 @@ int GlyphGroup::type( ) const
 	return Type ;
 }
 
-const TextState& GlyphGroup::Format( ) const
+const GraphicsState& GlyphGroup::Format( ) const
 {
 	return m_state ;
 }
diff --git a/pdfedit/src/GlyphGroup.hh b/pdfedit/src/GlyphGroup.hh
index 118ca5d..1da31eb 100644
--- a/pdfedit/src/GlyphGroup.hh
+++ b/pdfedit/src/GlyphGroup.hh
@@ -29,7 +29,7 @@
 #include <QGraphicsItemGroup>
 #include <graphics/CharVisitor.hh>
 
-#include <graphics/TextState.hh>
+#include <graphics/GraphicsState.hh>
 
 namespace pdf {
 
@@ -54,15 +54,15 @@ public :
 
 	static const int Type = UserType + 1 ;
 
-	const TextState& Format( ) const ;
+	const GraphicsState& Format( ) const ;
 	
 	TextLine GetLine( ) const ;
 	
 	QString Text( ) const ;
 
 private :
-	QString		m_text ;
-	TextState	m_state ;
+	QString			m_text ;
+	GraphicsState	m_state ;
 } ;
 
 } // end of namespace
diff --git a/pdfedit/src/MainWnd.cc b/pdfedit/src/MainWnd.cc
index a989d15..cff0ed3 100644
--- a/pdfedit/src/MainWnd.cc
+++ b/pdfedit/src/MainWnd.cc
@@ -44,8 +44,6 @@
 #include <QTransform>
 #include <QToolBar>
 
-#include <QGraphicsRectItem>
-
 #include <QDebug>
 
 #include "TextEdit.hh"
@@ -106,10 +104,6 @@ MainWnd::MainWnd( QWidget *parent )
 		SLOT(OnToolZoom(int)) ) ;
 	
 	m_tool_bar->addWidget( m_zoom_box ) ;
-	
-	QGraphicsRectItem *item = new QGraphicsRectItem( 100, 100, m_view->physicalDpiX(), m_view->physicalDpiX() ) ;
-	qDebug() << m_view->physicalDpiX() << " " << m_view->physicalDpiY() ;
-	m_scene->addItem( item ) ;
 }
 
 /**	destructor is for the auto_ptr	
-- 
1.6.6


From c7675170e40a5f0176feb962dc4ff327c20ed160 Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Fri, 19 Feb 2010 17:20:20 +0000
Subject: [PATCH 04/13] fixed zero argument handling for TJ operator

---
 libpdfdoc/src/graphics/RealText.cc |   37 ++++++++++++++++++++---------------
 libpdfdoc/src/page/RealContent.cc  |    5 +++-
 libpdfdoc/src/page/RealContent.hh  |   19 ++++++++++++++++++
 3 files changed, 44 insertions(+), 17 deletions(-)

diff --git a/libpdfdoc/src/graphics/RealText.cc b/libpdfdoc/src/graphics/RealText.cc
index 45e86f7..812beb0 100644
--- a/libpdfdoc/src/graphics/RealText.cc
+++ b/libpdfdoc/src/graphics/RealText.cc
@@ -295,29 +295,34 @@ void RealText::OnTj( Object* args, std::size_t count, Resources * )
 void RealText::OnTJ( Object* args, std::size_t count, Resources *res )
 {
 	PDF_ASSERT( !m_lines.empty() ) ;
-
+	
 	// current line
 	TextLine& current = m_lines.back() ;
 
 	double offset = 0.0 ;
 
-	Array& a = args[0].As<Array>() ;
-	for ( Array::iterator i = a.begin() ; i != a.end() ; ++i )
+	if ( count > 0 )
 	{
-		if ( i->Is<std::string>() )
+		Array& a = args[0].As<Array>() ;
+		for ( Array::iterator i = a.begin() ; i != a.end() ; ++i )
 		{
-			std::string& s = i->As<std::string>() ;
-			std::wstring ws( s.begin(), s.end() ) ;
-			offset += m_state.GetTextState().Width( ws ) ;
-
-			current.AppendText( ws ) ;
-		}
-		else if ( i->IsNumber() )
-		{
-			double disp = i->To<double>() / 1000.0 * m_state.GetTextState().FontSize() ;
-			offset -= disp ;
-			
-			current.AppendSpace( disp ) ;
+			if ( i->Is<std::string>() )
+			{
+				std::string& s = i->As<std::string>() ;
+				std::wstring ws( s.begin(), s.end() ) ;
+				offset += m_state.GetTextState().Width( ws ) ;
+	
+				current.AppendText( ws ) ;
+			}
+			else if ( i->IsNumber() )
+			{
+				double disp = i->To<double>() / 1000.0 *
+					m_state.GetTextState().FontSize() ;
+				
+				offset -= disp ;
+				
+				current.AppendSpace( disp ) ;
+			}
 		}
 	}
 	
diff --git a/libpdfdoc/src/page/RealContent.cc b/libpdfdoc/src/page/RealContent.cc
index 2322981..9790a8e 100644
--- a/libpdfdoc/src/page/RealContent.cc
+++ b/libpdfdoc/src/page/RealContent.cc
@@ -140,9 +140,12 @@ Graphics* RealContent::ProcessCommand(
 	}
 	else if ( gfx != 0 )
 	{
-		// TODO: remove dynamic_cast
 		gfx->OnCommand( cmd, args, count, res ) ;
 	}
+	
+	// page description level. this is the only place where the special
+	// graphics state operators are allowed. these will change the current
+	// transformation matrix (CTM).
 	else
 	{
 		gstate.OnCommand( cmd, args, count, res ) ;
diff --git a/libpdfdoc/src/page/RealContent.hh b/libpdfdoc/src/page/RealContent.hh
index eb0ecd5..96e3363 100644
--- a/libpdfdoc/src/page/RealContent.hh
+++ b/libpdfdoc/src/page/RealContent.hh
@@ -73,6 +73,25 @@ private :
 	void Load( Stream& str, Resources *res ) ;
 
 private :
+	/// This enum denotes the state of decoding graphics objects.
+	enum OperatorState
+	{
+		/// In the page description level, all graphics states operators
+		/// are allowed.
+		page_description_level,
+		
+		/// Inside a text object only general graphics states, colour, text
+		/// states and text positioning and showing operators are allowed.
+		text_object,
+		
+		/// Only path construction operators are allowed in path objects.
+		path_object,
+		
+		
+		clipping_path_object,
+		inline_image_object,
+	} ;
+
 	Graphics* ProcessCommand(
 		const Token& 	cmd,
 		Object 			*args,
-- 
1.6.6


From 95993285968316edc914fb63dba1415a8d6597ae Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sat, 20 Feb 2010 10:23:50 +0000
Subject: [PATCH 05/13] added content stream but not used yet

---
 libpdfdoc/CMakeLists.txt                    |    6 +-
 libpdfdoc/include/graphics/Graphics.hh      |    2 +-
 libpdfdoc/include/graphics/GraphicsState.hh |    9 +-
 libpdfdoc/src/graphics/GraphicsState.cc     |    8 +-
 libpdfdoc/src/graphics/RealText.cc          |   43 ++++--
 libpdfdoc/src/graphics/RealText.hh          |   27 ++---
 libpdfdoc/src/page/ContentStream.cc         |  189 +++++++++++++++++++++++++++
 libpdfdoc/src/page/ContentStream.hh         |   86 ++++++++++++
 8 files changed, 325 insertions(+), 45 deletions(-)
 create mode 100644 libpdfdoc/src/page/ContentStream.cc
 create mode 100644 libpdfdoc/src/page/ContentStream.hh

diff --git a/libpdfdoc/CMakeLists.txt b/libpdfdoc/CMakeLists.txt
index f5f9f59..543b62f 100644
--- a/libpdfdoc/CMakeLists.txt
+++ b/libpdfdoc/CMakeLists.txt
@@ -97,7 +97,8 @@ set( PAGE_HDRS		${PAGE_DIR}/RealPage.hh
 					${PAGE_DIR}/MockResources.hh
 					${PAGE_DIR}/PageNode.hh
 					${PAGE_DIR}/PageTree.hh
-					${PAGE_DIR}/PageInfo.hh )
+					${PAGE_DIR}/PageInfo.hh
+					${PAGE_DIR}/ContentStream.hh )
 
 set( GRAPICS_HDRS	${GRAPICS_DIR}/RealText.hh )
 
@@ -197,7 +198,8 @@ set( PAGE_SRCS  	${PAGE_DIR}/RealPage.cc
 					${PAGE_DIR}/RealContent.cc
 					${PAGE_DIR}/PageNode.cc
 					${PAGE_DIR}/PageTree.cc
-					${PAGE_DIR}/PageInfo.cc )
+					${PAGE_DIR}/PageInfo.cc
+					${PAGE_DIR}/ContentStream.cc )
 
 set( GRAPICS_SRCS	${GRAPICS_DIR}/Graphics.cc
 					${GRAPICS_DIR}/GraphicsVisitor.cc
diff --git a/libpdfdoc/include/graphics/Graphics.hh b/libpdfdoc/include/graphics/Graphics.hh
index e769125..d8987d3 100644
--- a/libpdfdoc/include/graphics/Graphics.hh
+++ b/libpdfdoc/include/graphics/Graphics.hh
@@ -64,7 +64,7 @@ public :
 		const Token& 	cmd,
 		Object 			*args,
 		std::size_t		count,
-		Resources		*res ) = 0 ;
+		const Resources	*res ) = 0 ;
 
 	virtual void Print( std::ostream& os, const Resources *res ) const = 0 ;
 
diff --git a/libpdfdoc/include/graphics/GraphicsState.hh b/libpdfdoc/include/graphics/GraphicsState.hh
index 4002ea7..ee6cd4a 100644
--- a/libpdfdoc/include/graphics/GraphicsState.hh
+++ b/libpdfdoc/include/graphics/GraphicsState.hh
@@ -65,7 +65,7 @@ public :
 		const Token& 	cmd,
 		Object 			*args,
 		std::size_t		count,
-		Resources		*res ) ;
+		const Resources	*res ) ;
 
 	static bool IsGSCommand( const Token& cmd ) ;
 
@@ -78,13 +78,10 @@ private :
 	struct HandlerMap ;
 
 	// text state command handlers
-	bool OnTf( Object* args, std::size_t count, Resources *res ) ;
-	bool OnTL( Object* args, std::size_t count, Resources *res ) ;
+	bool OnTf( Object* args, std::size_t count, const Resources *res ) ;
+	bool OnTL( Object* args, std::size_t count, const Resources *res ) ;
 
 private :
-	/// The current transformation matrix
-	Matrix		m_ctm ;
-	
 	TextState	m_text ;
 	
 	Colour		m_colour ;
diff --git a/libpdfdoc/src/graphics/GraphicsState.cc b/libpdfdoc/src/graphics/GraphicsState.cc
index 8ec6232..fbb43c3 100644
--- a/libpdfdoc/src/graphics/GraphicsState.cc
+++ b/libpdfdoc/src/graphics/GraphicsState.cc
@@ -45,7 +45,7 @@ struct GraphicsState::HandlerMap
 	typedef bool (GraphicsState::*Handler)(
 		Object			*args,
 		std::size_t		count,
-		Resources		*res ) ;
+		const Resources	*res ) ;
 	typedef std::map<Token, Handler>	Map ;
 
 	static const Map::value_type	m_val[] ;
@@ -98,7 +98,7 @@ bool GraphicsState::OnCommand(
 	const Token& 	cmd,
 	Object 			*args,
 	std::size_t		count,
-	Resources		*res )
+	const Resources	*res )
 {
 	HandlerMap::Map::const_iterator i = HandlerMap::m_map.find( cmd ) ;
 	if ( i != HandlerMap::m_map.end() )
@@ -113,7 +113,7 @@ bool GraphicsState::IsGSCommand( const Token& cmd )
 	return i != HandlerMap::m_map.end() ;
 }
 
-bool GraphicsState::OnTf( Object* args, std::size_t count, Resources *res )
+bool GraphicsState::OnTf( Object* args, std::size_t count, const Resources *res)
 {
 	PDF_ASSERT( res != 0 ) ;
 
@@ -137,7 +137,7 @@ bool GraphicsState::OnTf( Object* args, std::size_t count, Resources *res )
 	return false ;
 }
 
-bool GraphicsState::OnTL( Object* args, std::size_t count, Resources *res )
+bool GraphicsState::OnTL( Object* args, std::size_t count, const Resources *res)
 {
 	if ( count > 0 && args[0].IsNumber() )
 	{
diff --git a/libpdfdoc/src/graphics/RealText.cc b/libpdfdoc/src/graphics/RealText.cc
index 812beb0..4ad021f 100644
--- a/libpdfdoc/src/graphics/RealText.cc
+++ b/libpdfdoc/src/graphics/RealText.cc
@@ -45,7 +45,20 @@
 
 namespace pdf {
 
-const RealText::HandlerMap::value_type	RealText::m_handler_map_values[] =
+struct RealText::HandlerMap
+{
+	/// command handler
+	typedef void (RealText::*Handler)(
+		Object			*args,
+		std::size_t		count,
+		const Resources	*res ) ;
+	typedef std::map<Token, Handler>	Map ;
+
+	static const Map::value_type	m_val[] ;
+	static const Map				m_map ;
+} ;
+
+const RealText::HandlerMap::Map::value_type	RealText::HandlerMap::m_val[] =
 {
 	// text positioning commands
 	std::make_pair( "Td",	&RealText::OnTd ),
@@ -60,9 +73,9 @@ const RealText::HandlerMap::value_type	RealText::m_handler_map_values[] =
 	std::make_pair( "\"",	&RealText::OnDoubleQuote ),
 } ;
 
-const RealText::HandlerMap RealText::m_handler_map(
-    Begin( RealText::m_handler_map_values ),
-    End( RealText::m_handler_map_values ) ) ;
+const RealText::HandlerMap::Map RealText::HandlerMap::m_map(
+    Begin( RealText::HandlerMap::m_val ),
+    End( RealText::HandlerMap::m_val ) ) ;
 
 /**	constructor
 */
@@ -126,12 +139,12 @@ void RealText::OnCommand(
 	const Token& 	cmd,
 	Object 			*args,
 	std::size_t		count,
-	Resources		*res )
+	const Resources	*res )
 {
 	PDF_ASSERT( !m_lines.empty() ) ;
 
-	HandlerMap::const_iterator i = m_handler_map.find( cmd ) ;
-	if ( i != m_handler_map.end() )
+	HandlerMap::Map::const_iterator i = HandlerMap::m_map.find( cmd ) ;
+	if ( i != HandlerMap::m_map.end() )
 		(this->*(i->second))( args, count, res ) ;
 	
 	else if ( GraphicsState::IsGSCommand( cmd ) )
@@ -210,7 +223,7 @@ std::ostream& operator<<( std::ostream& os, const RealText& t )
 	return os ;
 }
 
-void RealText::OnTd( Object* args, std::size_t count, Resources* )
+void RealText::OnTd( Object* args, std::size_t count, const Resources* )
 {
 	if ( count >= 2 )
 	{
@@ -222,7 +235,7 @@ void RealText::OnTd( Object* args, std::size_t count, Resources* )
 	}
 }
 
-void RealText::OnTD( Object* args, std::size_t count, Resources *res )
+void RealText::OnTD( Object* args, std::size_t count, const Resources *res )
 {
 	
 	if ( count >= 2 )
@@ -238,7 +251,7 @@ void RealText::OnTD( Object* args, std::size_t count, Resources *res )
 	}
 }
 
-void RealText::OnTm( Object* args, std::size_t count, Resources* )
+void RealText::OnTm( Object* args, std::size_t count, const Resources* )
 {
 	if ( count >= 6 )
 	{
@@ -251,7 +264,7 @@ void RealText::OnTm( Object* args, std::size_t count, Resources* )
 	}
 }
 
-void RealText::OnTstar( Object* , std::size_t , Resources * )
+void RealText::OnTstar( Object* , std::size_t , const Resources * )
 {
 	m_line_mat.Dy( m_line_mat.Dy() -m_state.GetTextState().Leading() ) ;
 	m_text_mat = m_line_mat ;
@@ -260,7 +273,7 @@ void RealText::OnTstar( Object* , std::size_t , Resources * )
 }
 
 ///	Shows a Text string
-void RealText::OnTj( Object* args, std::size_t count, Resources * )
+void RealText::OnTj( Object* args, std::size_t count, const Resources * )
 {
 	PDF_ASSERT( !m_lines.empty() ) ;
 	
@@ -292,7 +305,7 @@ void RealText::OnTj( Object* args, std::size_t count, Resources * )
 	has the effect of moving the next glyph painted either to the left or down
 	by the given amount. 
 */
-void RealText::OnTJ( Object* args, std::size_t count, Resources *res )
+void RealText::OnTJ( Object* args, std::size_t count, const Resources *res )
 {
 	PDF_ASSERT( !m_lines.empty() ) ;
 	
@@ -331,11 +344,11 @@ void RealText::OnTJ( Object* args, std::size_t count, Resources *res )
 	m_text_mat.Dx( m_text_mat.Dx() + offset ) ; 
 }
 
-void RealText::OnSingleQuote( Object* args, std::size_t count, Resources *res )
+void RealText::OnSingleQuote( Object* args, std::size_t count, const Resources *res )
 {
 }
 
-void RealText::OnDoubleQuote( Object* args, std::size_t count, Resources *res )
+void RealText::OnDoubleQuote( Object* args, std::size_t count, const Resources *res )
 {
 }
 
diff --git a/libpdfdoc/src/graphics/RealText.hh b/libpdfdoc/src/graphics/RealText.hh
index d5a4533..06c7451 100644
--- a/libpdfdoc/src/graphics/RealText.hh
+++ b/libpdfdoc/src/graphics/RealText.hh
@@ -52,7 +52,7 @@ public :
 		const Token& 	cmd,
 		Object 			*args,
 		std::size_t		count,
-		Resources		*res ) ;
+		const Resources	*res ) ;
 
 	void Print( std::ostream& os, const Resources *res ) const ;
 
@@ -83,26 +83,19 @@ public :
 
 private :
     /// command handler
-	typedef void (RealText::*Handler)(
-		Object			*args,
-		std::size_t		count,
-		Resources		*res ) ;
-	typedef std::map<Token, Handler>	HandlerMap ;
-
-	static const HandlerMap::value_type	m_handler_map_values[] ;
-	static const HandlerMap				m_handler_map ;
+	struct HandlerMap ;
 
     // position command handlers
-	void OnTd( Object* args, std::size_t count, Resources *res ) ;
-	void OnTD( Object* args, std::size_t count, Resources *res ) ;
-	void OnTm( Object* args, std::size_t count, Resources *res ) ;
-	void OnTstar( Object* args, std::size_t count, Resources *res ) ;
+	void OnTd( Object* args, std::size_t count, const Resources *res ) ;
+	void OnTD( Object* args, std::size_t count, const Resources *res ) ;
+	void OnTm( Object* args, std::size_t count, const Resources *res ) ;
+	void OnTstar( Object* args, std::size_t count, const Resources *res ) ;
 	
 	// text show command handlers
-	void OnTj( Object* args, std::size_t count, Resources *res ) ;
-	void OnTJ( Object* args, std::size_t count, Resources *res ) ;
-	void OnSingleQuote( Object* args, std::size_t count, Resources *res ) ;
-	void OnDoubleQuote( Object* args, std::size_t count, Resources *res ) ;
+	void OnTj( Object* args, std::size_t count, const Resources *res ) ;
+	void OnTJ( Object* args, std::size_t count, const Resources *res ) ;
+	void OnSingleQuote( Object* args, std::size_t count, const Resources *res ) ;
+	void OnDoubleQuote( Object* args, std::size_t count, const Resources *res ) ;
 
 private :
 	///	Lines inside this text object
diff --git a/libpdfdoc/src/page/ContentStream.cc b/libpdfdoc/src/page/ContentStream.cc
new file mode 100644
index 0000000..56bd857
--- /dev/null
+++ b/libpdfdoc/src/page/ContentStream.cc
@@ -0,0 +1,189 @@
+/***************************************************************************\
+ *   Copyright (C) 2006 by Nestal Wan                                      *
+ *   me@nestal.net                                                         *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; version 2.                              *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+\***************************************************************************/
+
+/**	\file	ContentStream.cc
+	\brief	implementation of the ContentStream class
+	\date	Feb 20, 2010
+	\author	Nestal Wan
+*/
+
+#include "ContentStream.hh"
+
+#include "core/Object.hh"
+#include "core/Token.hh"
+#include "core/TokenSrc.hh"
+#include "graphics/GraphicsState.hh"
+#include "graphics/GraphicsVisitor.hh"
+#include "graphics/RealText.hh"
+#include "stream/Stream.hh"
+
+#include "util/Debug.hh"
+#include "util/Util.hh"
+
+#include <boost/bind.hpp>
+
+#include <algorithm>
+
+namespace pdf {
+
+struct ContentStream::HandlerMap
+{
+	/// command handler
+	typedef void (ContentStream::*Handler)(
+		Object			*args,
+		std::size_t		count ) ;
+	typedef std::map<Token, Handler>	Map ;
+
+	static const Map::value_type	m_val[] ;
+	static const Map				m_map ;
+} ;
+
+const ContentStream::HandlerMap::Map::value_type
+	ContentStream::HandlerMap::m_val[] =
+{
+	// text state commands
+	std::make_pair( "BT",	&ContentStream::OnBT ),
+	std::make_pair( "ET",	&ContentStream::OnET ),
+	std::make_pair( "cm",	&ContentStream::Oncm ),
+	std::make_pair( "Q",	&ContentStream::OnQ ),
+	std::make_pair( "q",	&ContentStream::Onq ),
+} ;
+
+
+const ContentStream::HandlerMap::Map ContentStream::HandlerMap::m_map(
+    Begin( ContentStream::HandlerMap::m_val ),
+    End( ContentStream::HandlerMap::m_val ) ) ;
+
+/**	constructor
+	
+*/
+void ContentStream::Decode( )
+{
+	std::for_each(
+		m_strs.begin(),
+		m_strs.end(),
+		boost::bind( &ContentStream::Decode, this, _1 ) ) ;
+}
+
+void ContentStream::Decode( Stream& str )
+{
+	PDF_ASSERT( m_res != 0 ) ;
+	PDF_ASSERT( m_current == 0 ) ;
+
+	// rewind to stream start for reading
+	str.Rewind( ) ;
+	
+//	std::ostringstream ss ;
+//	str.CopyData( ss.rdbuf() ) ;
+//	std::cout << ss.str() << std::endl ;
+//	str.Rewind() ;
+	
+	std::istream s( str.InStreamBuf() ) ;
+	TokenSrc src( s ) ;
+	std::vector<Object> args ;
+
+	GraphicsState	gstate ;
+
+	while ( true )
+	{
+		Token  cmd ;
+		Object obj ;
+
+		if ( src >> obj )
+		{
+			// swapping is faster
+			args.push_back( Object() ) ;
+			obj.Swap( args.back() ) ;
+		}
+		
+		// if it is not an object, then it should be a command operator
+		else
+		{
+			src.ResetState( ) ;
+			if ( src >> cmd )
+			{
+/*std::cout << cmd.Get() << " " ;
+std::copy( args.begin(), args.end(), std::ostream_iterator<Object>( std::cout, " " ) ) ;
+std::cout << std::endl ;
+*/
+
+//				current = ProcessCommand(
+//					cmd,
+//					args.empty() ? 0 : &args[0],	// don't touch args[0]
+//					args.size(),					// if empty.
+//					gstate,
+//					current,
+//					res ) ;
+
+				args.clear( ) ;
+			}
+			else
+				break ;
+		}
+	}
+}
+
+void ContentStream::ProcessCommand(
+	const Token& 	cmd,
+	Object 			*args,
+	std::size_t 	count )
+{
+	if ( m_current != 0 )
+		m_current->OnCommand( cmd, args, count, m_res ) ;
+	else
+	{
+		HandlerMap::Map::const_iterator i = HandlerMap::m_map.find( cmd ) ;
+		if ( i != HandlerMap::m_map.end() )
+		{
+			PDF_ASSERT( i->second != 0 ) ;
+			(this->*(i->second))( args, count ) ;
+		}
+	}
+}
+
+void ContentStream::OnBT( Object *, std::size_t )
+{
+	if ( m_current == 0 )
+		m_current = new RealText( m_state ) ;
+}
+
+void ContentStream::OnET( Object *, std::size_t )
+{
+	if ( m_current != 0 )
+	{
+		m_state = m_current->GetState( ) ;
+		
+		m_gfx.push_back( m_current ) ;
+		m_current = 0 ;
+	}
+}
+
+void ContentStream::Oncm( Object *args, std::size_t count )
+{
+}
+
+void ContentStream::OnQ( Object *args, std::size_t count )
+{
+}
+
+void ContentStream::Onq( Object *args, std::size_t count )
+{
+}
+
+} // end of namespace
diff --git a/libpdfdoc/src/page/ContentStream.hh b/libpdfdoc/src/page/ContentStream.hh
new file mode 100644
index 0000000..a68045b
--- /dev/null
+++ b/libpdfdoc/src/page/ContentStream.hh
@@ -0,0 +1,86 @@
+/***************************************************************************\
+ *   Copyright (C) 2006 by Nestal Wan                                      *
+ *   me@nestal.net                                                         *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; version 2.                              *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+\***************************************************************************/
+
+/**	\file	ContentStream.hh
+    \brief	definition the ContentStream class
+    \date	Feb 20, 2010
+    \author	Nestal Wan
+*/
+
+#ifndef __PDF_CONTENTSTREAM_HH_EADER_INCLUDED__
+#define __PDF_CONTENTSTREAM_HH_EADER_INCLUDED__
+
+#include "graphics/GraphicsState.hh"
+#include "stream/Stream.hh"
+
+#include <vector>
+
+namespace pdf {
+
+class Graphics ;
+class Resources ;
+
+///	brief description
+/**	\internal
+	The ContentStream class represents
+*/
+class ContentStream
+{
+public :
+	template <typename InputIt>
+	ContentStream( InputIt first, InputIt last, const Resources *res )
+		: m_strs( first, last ),
+		  m_res( res ),
+		  m_current( 0 )
+	{
+	}
+
+	void Decode( ) ;
+
+private :
+	struct HandlerMap ;
+	
+	void Decode( Stream& str ) ;
+
+	void ProcessCommand(
+		const Token& 	cmd,
+		Object 			*args,
+		std::size_t 	count ) ;
+
+	void OnBT( Object *args, std::size_t count ) ;
+	void OnET( Object *args, std::size_t count ) ;
+	void Oncm( Object *args, std::size_t count ) ;
+	void OnQ( Object *args, std::size_t count ) ;
+	void Onq( Object *args, std::size_t count ) ;
+
+private :
+	std::vector<Stream>		m_strs ;
+	std::vector<Graphics*>	m_gfx ;
+	const Resources			*m_res ;
+
+	//@{
+	/// Context information for decoding the graphics objects
+	Graphics				*m_current ;
+	GraphicsState			m_state ;
+	//@}
+} ;
+
+} // end of namespace
+
+#endif // CONTENTSTREAM_HH_
-- 
1.6.6


From 5406dfb5a58f450a32ae3c24fb62fad28622891f Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sat, 20 Feb 2010 13:46:58 +0000
Subject: [PATCH 06/13] moved some documentation to wiki

---
 libpdfdoc/doc/Doxyfile                 |  465 ++++++++++++++------------------
 libpdfdoc/doc/MainPage.doxygen         |  155 -----------
 libpdfdoc/include/font/Font.hh         |    8 +-
 libpdfdoc/include/font/Glyph.hh        |    2 +-
 libpdfdoc/include/font/Outline.hh      |    2 +-
 libpdfdoc/include/graphics/Graphics.hh |   23 ++
 libpdfdoc/include/libpdfdoc.hh         |   43 +++-
 7 files changed, 275 insertions(+), 423 deletions(-)
 delete mode 100644 libpdfdoc/doc/MainPage.doxygen

diff --git a/libpdfdoc/doc/Doxyfile b/libpdfdoc/doc/Doxyfile
index 2adcda3..6a1a716 100644
--- a/libpdfdoc/doc/Doxyfile
+++ b/libpdfdoc/doc/Doxyfile
@@ -20,25 +20,25 @@
 # iconv built into libc) for the transcoding. See
 # http://www.gnu.org/software/libiconv for the list of possible encodings.
 
-DOXYFILE_ENCODING      = UTF-8
+DOXYFILE_ENCODING = UTF-8
 
 # The PROJECT_NAME tag is a single word (or a sequence of words surrounded
 # by quotes) that should identify the project.
 
-PROJECT_NAME           = libpdfdoc
+PROJECT_NAME = libpdfdoc
 
 # The PROJECT_NUMBER tag can be used to enter a project or revision number.
 # This could be handy for archiving the generated documentation or
 # if some version control system is used.
 
-PROJECT_NUMBER         = 0.1.0
+PROJECT_NUMBER = 0.1.0
 
 # The OUTPUT_DIRECTORY tag is used to specify the (relative or absolute)
 # base path where the generated documentation will be put.
 # If a relative path is entered, it will be relative to the location
 # where doxygen was started. If left blank the current directory will be used.
 
-OUTPUT_DIRECTORY       =
+OUTPUT_DIRECTORY = 
 
 # If the CREATE_SUBDIRS tag is set to YES, then doxygen will create
 # 4096 sub-directories (in 2 levels) under the output directory of each output
@@ -47,7 +47,7 @@ OUTPUT_DIRECTORY       =
 # source files, where putting all generated files in the same directory would
 # otherwise cause performance problems for the file system.
 
-CREATE_SUBDIRS         = NO
+CREATE_SUBDIRS = NO
 
 # The OUTPUT_LANGUAGE tag is used to specify the language in which all
 # documentation generated by doxygen is written. Doxygen will use this
@@ -60,21 +60,21 @@ CREATE_SUBDIRS         = NO
 # Polish, Portuguese, Romanian, Russian, Serbian, Serbian-Cyrilic, Slovak,
 # Slovene, Spanish, Swedish, Ukrainian, and Vietnamese.
 
-OUTPUT_LANGUAGE        = English
+OUTPUT_LANGUAGE = English
 
 # If the BRIEF_MEMBER_DESC tag is set to YES (the default) Doxygen will
 # include brief member descriptions after the members that are listed in
 # the file and class documentation (similar to JavaDoc).
 # Set to NO to disable this.
 
-BRIEF_MEMBER_DESC      = YES
+BRIEF_MEMBER_DESC = YES
 
 # If the REPEAT_BRIEF tag is set to YES (the default) Doxygen will prepend
 # the brief description of a member or function before the detailed description.
 # Note: if both HIDE_UNDOC_MEMBERS and BRIEF_MEMBER_DESC are set to NO, the
 # brief descriptions will be completely suppressed.
 
-REPEAT_BRIEF           = NO
+REPEAT_BRIEF = NO
 
 # This tag implements a quasi-intelligent brief description abbreviator
 # that is used to form the text in various listings. Each string
@@ -86,36 +86,26 @@ REPEAT_BRIEF           = NO
 # "The $name file" "is" "provides" "specifies" "contains"
 # "represents" "a" "an" "the"
 
-ABBREVIATE_BRIEF       = "The $name class" \
-                         "The $name widget" \
-                         "The $name file" \
-                         is \
-                         provides \
-                         specifies \
-                         contains \
-                         represents \
-                         a \
-                         an \
-                         the
+ABBREVIATE_BRIEF = "The $name class" "The $name widget" "The $name file" is provides specifies contains represents a an the
 
 # If the ALWAYS_DETAILED_SEC and REPEAT_BRIEF tags are both set to YES then
 # Doxygen will generate a detailed section even if there is only a brief
 # description.
 
-ALWAYS_DETAILED_SEC    = NO
+ALWAYS_DETAILED_SEC = NO
 
 # If the INLINE_INHERITED_MEMB tag is set to YES, doxygen will show all
 # inherited members of a class in the documentation of that class as if those
 # members were ordinary class members. Constructors, destructors and assignment
 # operators of the base classes will not be shown.
 
-INLINE_INHERITED_MEMB  = NO
+INLINE_INHERITED_MEMB = NO
 
 # If the FULL_PATH_NAMES tag is set to YES then Doxygen will prepend the full
 # path before files name in the file list and in the header files. If set
 # to NO the shortest path that makes the file name unique will be used.
 
-FULL_PATH_NAMES        = YES
+FULL_PATH_NAMES = YES
 
 # If the FULL_PATH_NAMES tag is set to YES then the STRIP_FROM_PATH tag
 # can be used to strip a user-defined part of the path. Stripping is
@@ -124,7 +114,7 @@ FULL_PATH_NAMES        = YES
 # If left blank the directory from which doxygen is run is used as the
 # path to strip.
 
-STRIP_FROM_PATH        = /home/nestal/code/libpdfxx/libpdfdoc
+STRIP_FROM_PATH = /home/nestal/code/libpdfxx/libpdfdoc
 
 # The STRIP_FROM_INC_PATH tag can be used to strip a user-defined part of
 # the path mentioned in the documentation of a class, which tells
@@ -133,13 +123,13 @@ STRIP_FROM_PATH        = /home/nestal/code/libpdfxx/libpdfdoc
 # definition is used. Otherwise one should specify the include paths that
 # are normally passed to the compiler using the -I flag.
 
-STRIP_FROM_INC_PATH    =
+STRIP_FROM_INC_PATH = 
 
 # If the SHORT_NAMES tag is set to YES, doxygen will generate much shorter
 # (but less readable) file names. This can be useful is your file systems
 # doesn't support long names like on DOS, Mac, or CD-ROM.
 
-SHORT_NAMES            = NO
+SHORT_NAMES = NO
 
 # If the JAVADOC_AUTOBRIEF tag is set to YES then Doxygen
 # will interpret the first line (until the first dot) of a JavaDoc-style
@@ -147,7 +137,7 @@ SHORT_NAMES            = NO
 # comments will behave just like regular Qt-style comments
 # (thus requiring an explicit @brief command for a brief description.)
 
-JAVADOC_AUTOBRIEF      = NO
+JAVADOC_AUTOBRIEF = NO
 
 # If the QT_AUTOBRIEF tag is set to YES then Doxygen will
 # interpret the first line (until the first dot) of a Qt-style
@@ -155,7 +145,7 @@ JAVADOC_AUTOBRIEF      = NO
 # will behave just like regular Qt-style comments (thus requiring
 # an explicit \brief command for a brief description.)
 
-QT_AUTOBRIEF           = YES
+QT_AUTOBRIEF = YES
 
 # The MULTILINE_CPP_IS_BRIEF tag can be set to YES to make Doxygen
 # treat a multi-line C++ special comment block (i.e. a block of //! or ///
@@ -169,18 +159,18 @@ MULTILINE_CPP_IS_BRIEF = NO
 # member inherits the documentation from any documented member that it
 # re-implements.
 
-INHERIT_DOCS           = YES
+INHERIT_DOCS = YES
 
 # If the SEPARATE_MEMBER_PAGES tag is set to YES, then doxygen will produce
 # a new page for each member. If set to NO, the documentation of a member will
 # be part of the file/class/namespace that contains it.
 
-SEPARATE_MEMBER_PAGES  = NO
+SEPARATE_MEMBER_PAGES = NO
 
 # The TAB_SIZE tag can be used to set the number of spaces in a tab.
 # Doxygen uses this value to replace tabs by spaces in code fragments.
 
-TAB_SIZE               = 4
+TAB_SIZE = 4
 
 # This tag can be used to specify a number of aliases that acts
 # as commands in the documentation. An alias has the form "name=value".
@@ -189,33 +179,33 @@ TAB_SIZE               = 4
 # will result in a user-defined paragraph with heading "Side Effects:".
 # You can put \n's in the value part of an alias to insert newlines.
 
-ALIASES                =
+ALIASES = 
 
 # Set the OPTIMIZE_OUTPUT_FOR_C tag to YES if your project consists of C
 # sources only. Doxygen will then generate output that is more tailored for C.
 # For instance, some of the names that are used will be different. The list
 # of all members will be omitted, etc.
 
-OPTIMIZE_OUTPUT_FOR_C  = NO
+OPTIMIZE_OUTPUT_FOR_C = NO
 
 # Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java
 # sources only. Doxygen will then generate output that is more tailored for
 # Java. For instance, namespaces will be presented as packages, qualified
 # scopes will look different, etc.
 
-OPTIMIZE_OUTPUT_JAVA   = NO
+OPTIMIZE_OUTPUT_JAVA = NO
 
 # Set the OPTIMIZE_FOR_FORTRAN tag to YES if your project consists of Fortran
 # sources only. Doxygen will then generate output that is more tailored for
 # Fortran.
 
-OPTIMIZE_FOR_FORTRAN   = NO
+OPTIMIZE_FOR_FORTRAN = NO
 
 # Set the OPTIMIZE_OUTPUT_VHDL tag to YES if your project consists of VHDL
 # sources. Doxygen will then generate output that is tailored for
 # VHDL.
 
-OPTIMIZE_OUTPUT_VHDL   = NO
+OPTIMIZE_OUTPUT_VHDL = NO
 
 # Doxygen selects the parser to use depending on the extension of the files it parses.
 # With this tag you can assign which parser to use for a given extension.
@@ -226,7 +216,7 @@ OPTIMIZE_OUTPUT_VHDL   = NO
 # .inc files as Fortran files (default is PHP), and .f files as C (default is Fortran),
 # use: inc=Fortran f=C. Note that for custom extensions you also need to set FILE_PATTERNS otherwise the files are not read by doxygen.
 
-EXTENSION_MAPPING      =
+EXTENSION_MAPPING = 
 
 # If you use STL classes (i.e. std::string, std::vector, etc.) but do not want
 # to include (a tag file for) the STL sources as input, then you should
@@ -235,18 +225,18 @@ EXTENSION_MAPPING      =
 # func(std::string) {}). This also make the inheritance and collaboration
 # diagrams that involve STL classes more complete and accurate.
 
-BUILTIN_STL_SUPPORT    = YES
+BUILTIN_STL_SUPPORT = YES
 
 # If you use Microsoft's C++/CLI language, you should set this option to YES to
 # enable parsing support.
 
-CPP_CLI_SUPPORT        = NO
+CPP_CLI_SUPPORT = NO
 
 # Set the SIP_SUPPORT tag to YES if your project consists of sip sources only.
 # Doxygen will parse them like normal C++ but will assume all classes use public
 # instead of private inheritance when no explicit protection keyword is present.
 
-SIP_SUPPORT            = NO
+SIP_SUPPORT = NO
 
 # For Microsoft's IDL there are propget and propput attributes to indicate getter
 # and setter methods for a property. Setting this option to YES (the default)
@@ -255,14 +245,14 @@ SIP_SUPPORT            = NO
 # setting a simple type. If this is not the case, or you want to show the
 # methods anyway, you should set this option to NO.
 
-IDL_PROPERTY_SUPPORT   = YES
+IDL_PROPERTY_SUPPORT = YES
 
 # If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC
 # tag is set to YES, then doxygen will reuse the documentation of the first
 # member in the group (if any) for the other members of the group. By default
 # all members of a group must be documented explicitly.
 
-DISTRIBUTE_GROUP_DOC   = YES
+DISTRIBUTE_GROUP_DOC = YES
 
 # Set the SUBGROUPING tag to YES (the default) to allow class member groups of
 # the same type (for instance a group of public functions) to be put as a
@@ -270,7 +260,7 @@ DISTRIBUTE_GROUP_DOC   = YES
 # NO to prevent subgrouping. Alternatively, this can be done per class using
 # the \nosubgrouping command.
 
-SUBGROUPING            = YES
+SUBGROUPING = YES
 
 # When TYPEDEF_HIDES_STRUCT is enabled, a typedef of a struct, union, or enum
 # is documented as struct, union, or enum with the name of the typedef. So
@@ -280,7 +270,7 @@ SUBGROUPING            = YES
 # be useful for C code in case the coding convention dictates that all compound
 # types are typedef'ed and only the typedef is referenced, never the tag name.
 
-TYPEDEF_HIDES_STRUCT   = NO
+TYPEDEF_HIDES_STRUCT = NO
 
 # The SYMBOL_CACHE_SIZE determines the size of the internal cache use to
 # determine which symbols to keep in memory and which to flush to disk.
@@ -296,7 +286,7 @@ TYPEDEF_HIDES_STRUCT   = NO
 # 2^(16+SYMBOL_CACHE_SIZE). The valid range is 0..9, the default is 0,
 # corresponding to a cache size of 2^16 = 65536 symbols
 
-SYMBOL_CACHE_SIZE      = 0
+SYMBOL_CACHE_SIZE = 0
 
 #---------------------------------------------------------------------------
 # Build related configuration options
@@ -307,30 +297,30 @@ SYMBOL_CACHE_SIZE      = 0
 # Private class members and static file members will be hidden unless
 # the EXTRACT_PRIVATE and EXTRACT_STATIC tags are set to YES
 
-EXTRACT_ALL            = NO
+EXTRACT_ALL = NO
 
 # If the EXTRACT_PRIVATE tag is set to YES all private members of a class
 # will be included in the documentation.
 
-EXTRACT_PRIVATE        = NO
+EXTRACT_PRIVATE = NO
 
 # If the EXTRACT_STATIC tag is set to YES all static members of a file
 # will be included in the documentation.
 
-EXTRACT_STATIC         = YES
+EXTRACT_STATIC = YES
 
 # If the EXTRACT_LOCAL_CLASSES tag is set to YES classes (and structs)
 # defined locally in source files will be included in the documentation.
 # If set to NO only classes defined in header files are included.
 
-EXTRACT_LOCAL_CLASSES  = NO
+EXTRACT_LOCAL_CLASSES = NO
 
 # This flag is only useful for Objective-C code. When set to YES local
 # methods, which are defined in the implementation section but not in
 # the interface are included in the documentation.
 # If set to NO (the default) only methods in the interface are included.
 
-EXTRACT_LOCAL_METHODS  = NO
+EXTRACT_LOCAL_METHODS = NO
 
 # If this flag is set to YES, the members of anonymous namespaces will be
 # extracted and appear in the documentation as a namespace called
@@ -338,7 +328,7 @@ EXTRACT_LOCAL_METHODS  = NO
 # name of the file that contains the anonymous namespace. By default
 # anonymous namespace are hidden.
 
-EXTRACT_ANON_NSPACES   = NO
+EXTRACT_ANON_NSPACES = NO
 
 # If the HIDE_UNDOC_MEMBERS tag is set to YES, Doxygen will hide all
 # undocumented members of documented classes, files or namespaces.
@@ -346,35 +336,35 @@ EXTRACT_ANON_NSPACES   = NO
 # various overviews, but no documentation section is generated.
 # This option has no effect if EXTRACT_ALL is enabled.
 
-HIDE_UNDOC_MEMBERS     = YES
+HIDE_UNDOC_MEMBERS = YES
 
 # If the HIDE_UNDOC_CLASSES tag is set to YES, Doxygen will hide all
 # undocumented classes that are normally visible in the class hierarchy.
 # If set to NO (the default) these classes will be included in the various
 # overviews. This option has no effect if EXTRACT_ALL is enabled.
 
-HIDE_UNDOC_CLASSES     = YES
+HIDE_UNDOC_CLASSES = YES
 
 # If the HIDE_FRIEND_COMPOUNDS tag is set to YES, Doxygen will hide all
 # friend (class|struct|union) declarations.
 # If set to NO (the default) these declarations will be included in the
 # documentation.
 
-HIDE_FRIEND_COMPOUNDS  = NO
+HIDE_FRIEND_COMPOUNDS = NO
 
 # If the HIDE_IN_BODY_DOCS tag is set to YES, Doxygen will hide any
 # documentation blocks found inside the body of a function.
 # If set to NO (the default) these blocks will be appended to the
 # function's detailed documentation block.
 
-HIDE_IN_BODY_DOCS      = NO
+HIDE_IN_BODY_DOCS = NO
 
 # The INTERNAL_DOCS tag determines if documentation
 # that is typed after a \internal command is included. If the tag is set
 # to NO (the default) then the documentation will be excluded.
 # Set it to YES to include the internal documentation.
 
-INTERNAL_DOCS          = NO
+INTERNAL_DOCS = NO
 
 # If the CASE_SENSE_NAMES tag is set to NO then Doxygen will only generate
 # file names in lower-case letters. If set to YES upper-case letters are also
@@ -382,38 +372,38 @@ INTERNAL_DOCS          = NO
 # in case and if your file system supports case sensitive file names. Windows
 # and Mac users are advised to set this option to NO.
 
-CASE_SENSE_NAMES       = YES
+CASE_SENSE_NAMES = YES
 
 # If the HIDE_SCOPE_NAMES tag is set to NO (the default) then Doxygen
 # will show members with their full class and namespace scopes in the
 # documentation. If set to YES the scope will be hidden.
 
-HIDE_SCOPE_NAMES       = NO
+HIDE_SCOPE_NAMES = NO
 
 # If the SHOW_INCLUDE_FILES tag is set to YES (the default) then Doxygen
 # will put a list of the files that are included by a file in the documentation
 # of that file.
 
-SHOW_INCLUDE_FILES     = YES
+SHOW_INCLUDE_FILES = YES
 
 # If the INLINE_INFO tag is set to YES (the default) then a tag [inline]
 # is inserted in the documentation for inline members.
 
-INLINE_INFO            = YES
+INLINE_INFO = YES
 
 # If the SORT_MEMBER_DOCS tag is set to YES (the default) then doxygen
 # will sort the (detailed) documentation of file and class members
 # alphabetically by member name. If set to NO the members will appear in
 # declaration order.
 
-SORT_MEMBER_DOCS       = YES
+SORT_MEMBER_DOCS = YES
 
 # If the SORT_BRIEF_DOCS tag is set to YES then doxygen will sort the
 # brief documentation of file, namespace and class members alphabetically
 # by member name. If set to NO (the default) the members will appear in
 # declaration order.
 
-SORT_BRIEF_DOCS        = NO
+SORT_BRIEF_DOCS = NO
 
 # If the SORT_MEMBERS_CTORS_1ST tag is set to YES then doxygen will sort the (brief and detailed) documentation of class members so that constructors and destructors are listed first. If set to NO (the default) the constructors will appear in the respective orders defined by SORT_MEMBER_DOCS and SORT_BRIEF_DOCS. This tag will be ignored for brief docs if SORT_BRIEF_DOCS is set to NO and ignored for detailed docs if SORT_MEMBER_DOCS is set to NO.
 
@@ -423,7 +413,7 @@ SORT_MEMBERS_CTORS_1ST = NO
 # hierarchy of group names into alphabetical order. If set to NO (the default)
 # the group names will appear in their defined order.
 
-SORT_GROUP_NAMES       = NO
+SORT_GROUP_NAMES = NO
 
 # If the SORT_BY_SCOPE_NAME tag is set to YES, the class list will be
 # sorted by fully-qualified names, including namespaces. If set to
@@ -433,36 +423,36 @@ SORT_GROUP_NAMES       = NO
 # Note: This option applies only to the class list, not to the
 # alphabetical list.
 
-SORT_BY_SCOPE_NAME     = NO
+SORT_BY_SCOPE_NAME = NO
 
 # The GENERATE_TODOLIST tag can be used to enable (YES) or
 # disable (NO) the todo list. This list is created by putting \todo
 # commands in the documentation.
 
-GENERATE_TODOLIST      = YES
+GENERATE_TODOLIST = YES
 
 # The GENERATE_TESTLIST tag can be used to enable (YES) or
 # disable (NO) the test list. This list is created by putting \test
 # commands in the documentation.
 
-GENERATE_TESTLIST      = YES
+GENERATE_TESTLIST = YES
 
 # The GENERATE_BUGLIST tag can be used to enable (YES) or
 # disable (NO) the bug list. This list is created by putting \bug
 # commands in the documentation.
 
-GENERATE_BUGLIST       = YES
+GENERATE_BUGLIST = YES
 
 # The GENERATE_DEPRECATEDLIST tag can be used to enable (YES) or
 # disable (NO) the deprecated list. This list is created by putting
 # \deprecated commands in the documentation.
 
-GENERATE_DEPRECATEDLIST= YES
+GENERATE_DEPRECATEDLIST = YES
 
 # The ENABLED_SECTIONS tag can be used to enable conditional
 # documentation sections, marked by \if sectionname ... \endif.
 
-ENABLED_SECTIONS       =
+ENABLED_SECTIONS = 
 
 # The MAX_INITIALIZER_LINES tag determines the maximum number of lines
 # the initial value of a variable or define consists of for it to appear in
@@ -472,32 +462,32 @@ ENABLED_SECTIONS       =
 # documentation can be controlled using \showinitializer or \hideinitializer
 # command in the documentation regardless of this setting.
 
-MAX_INITIALIZER_LINES  = 30
+MAX_INITIALIZER_LINES = 30
 
 # Set the SHOW_USED_FILES tag to NO to disable the list of files generated
 # at the bottom of the documentation of classes and structs. If set to YES the
 # list will mention the files that were used to generate the documentation.
 
-SHOW_USED_FILES        = YES
+SHOW_USED_FILES = YES
 
 # If the sources in your project are distributed over multiple directories
 # then setting the SHOW_DIRECTORIES tag to YES will show the directory hierarchy
 # in the documentation. The default is NO.
 
-SHOW_DIRECTORIES       = NO
+SHOW_DIRECTORIES = NO
 
 # Set the SHOW_FILES tag to NO to disable the generation of the Files page.
 # This will remove the Files entry from the Quick Index and from the
 # Folder Tree View (if specified). The default is YES.
 
-SHOW_FILES             = YES
+SHOW_FILES = YES
 
 # Set the SHOW_NAMESPACES tag to NO to disable the generation of the
 # Namespaces page.
 # This will remove the Namespaces entry from the Quick Index
 # and from the Folder Tree View (if specified). The default is YES.
 
-SHOW_NAMESPACES        = NO
+SHOW_NAMESPACES = NO
 
 # The FILE_VERSION_FILTER tag can be used to specify a program or script that
 # doxygen should invoke to get the current version for each file (typically from
@@ -507,7 +497,7 @@ SHOW_NAMESPACES        = NO
 # provided by doxygen. Whatever the program writes to standard output
 # is used as the file version. See the manual for examples.
 
-FILE_VERSION_FILTER    =
+FILE_VERSION_FILTER = 
 
 # The LAYOUT_FILE tag can be used to specify a layout file which will be parsed by
 # doxygen. The layout file controls the global structure of the generated output files
@@ -516,7 +506,7 @@ FILE_VERSION_FILTER    =
 # file name after the option, if omitted DoxygenLayout.xml will be used as the name
 # of the layout file.
 
-LAYOUT_FILE            =
+LAYOUT_FILE = 
 
 #---------------------------------------------------------------------------
 # configuration options related to warning and progress messages
@@ -525,26 +515,26 @@ LAYOUT_FILE            =
 # The QUIET tag can be used to turn on/off the messages that are generated
 # by doxygen. Possible values are YES and NO. If left blank NO is used.
 
-QUIET                  = NO
+QUIET = NO
 
 # The WARNINGS tag can be used to turn on/off the warning messages that are
 # generated by doxygen. Possible values are YES and NO. If left blank
 # NO is used.
 
-WARNINGS               = YES
+WARNINGS = YES
 
 # If WARN_IF_UNDOCUMENTED is set to YES, then doxygen will generate warnings
 # for undocumented members. If EXTRACT_ALL is set to YES then this flag will
 # automatically be disabled.
 
-WARN_IF_UNDOCUMENTED   = NO
+WARN_IF_UNDOCUMENTED = NO
 
 # If WARN_IF_DOC_ERROR is set to YES, doxygen will generate warnings for
 # potential errors in the documentation, such as not documenting some
 # parameters in a documented function, or documenting parameters that
 # don't exist or using markup commands wrongly.
 
-WARN_IF_DOC_ERROR      = YES
+WARN_IF_DOC_ERROR = YES
 
 # This WARN_NO_PARAMDOC option can be abled to get warnings for
 # functions that are documented, but have no documentation for their parameters
@@ -552,7 +542,7 @@ WARN_IF_DOC_ERROR      = YES
 # wrong or incomplete parameter documentation, but not about the absence of
 # documentation.
 
-WARN_NO_PARAMDOC       = NO
+WARN_NO_PARAMDOC = NO
 
 # The WARN_FORMAT tag determines the format of the warning messages that
 # doxygen can produce. The string should contain the $file, $line, and $text
@@ -561,13 +551,13 @@ WARN_NO_PARAMDOC       = NO
 # $version, which will be replaced by the version of the file (if it could
 # be obtained via FILE_VERSION_FILTER)
 
-WARN_FORMAT            = "$file:$line: $text"
+WARN_FORMAT = "$file:$line: $text"
 
 # The WARN_LOGFILE tag can be used to specify a file to which warning
 # and error messages should be written. If left blank the output is written
 # to stderr.
 
-WARN_LOGFILE           =
+WARN_LOGFILE = 
 
 #---------------------------------------------------------------------------
 # configuration options related to the input files
@@ -578,8 +568,7 @@ WARN_LOGFILE           =
 # directories like "/usr/src/myproject". Separate the files or directories
 # with spaces.
 
-INPUT                  = ../include \
-                         MainPage.doxygen
+INPUT = ../include 
 
 # This tag can be used to specify the character encoding of the source files
 # that doxygen parses. Internally doxygen uses the UTF-8 encoding, which is
@@ -587,7 +576,7 @@ INPUT                  = ../include \
 # into libc) for the transcoding. See http://www.gnu.org/software/libiconv for
 # the list of possible encodings.
 
-INPUT_ENCODING         = UTF-8
+INPUT_ENCODING = UTF-8
 
 # If the value of the INPUT tag contains directories, you can use the
 # FILE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp
@@ -596,71 +585,25 @@ INPUT_ENCODING         = UTF-8
 # *.c *.cc *.cxx *.cpp *.c++ *.java *.ii *.ixx *.ipp *.i++ *.inl *.h *.hh *.hxx
 # *.hpp *.h++ *.idl *.odl *.cs *.php *.php3 *.inc *.m *.mm *.py *.f90
 
-FILE_PATTERNS          = *.cc \
-                         *.cxx \
-                         *.cpp \
-                         *.c++ \
-                         *.d \
-                         *.java \
-                         *.ii \
-                         *.ixx \
-                         *.ipp \
-                         *.i++ \
-                         *.inl \
-                         *.hh \
-                         *.hxx \
-                         *.hpp \
-                         *.h++ \
-                         *.idl \
-                         *.odl \
-                         *.cs \
-                         *.php \
-                         *.php3 \
-                         *.inc \
-                         *.m \
-                         *.mm \
-                         *.dox \
-                         *.py \
-                         *.C \
-                         *.CC \
-                         *.C++ \
-                         *.II \
-                         *.I++ \
-                         *.H \
-                         *.HH \
-                         *.H++ \
-                         *.CS \
-                         *.PHP \
-                         *.PHP3 \
-                         *.M \
-                         *.MM \
-                         *.PY \
-                         *.C \
-                         *.H \
-                         *.tlh \
-                         *.diff \
-                         *.patch \
-                         *.moc \
-                         *.xpm \
-                         *.dox
+FILE_PATTERNS = *.cc *.cxx *.cpp *.c++ *.d *.java *.ii *.ixx *.ipp *.i++ *.inl *.hh *.hxx *.hpp *.h++ *.idl *.odl *.cs *.php *.php3 *.inc *.m *.mm *.dox *.py *.C *.CC *.C++ *.II *.I++ *.H *.HH *.H++ *.CS *.PHP *.PHP3 *.M *.MM *.PY *.C *.H *.tlh *.diff *.patch *.moc *.xpm *.dox
 
 # The RECURSIVE tag can be used to turn specify whether or not subdirectories
 # should be searched for input files as well. Possible values are YES and NO.
 # If left blank NO is used.
 
-RECURSIVE              = yes
+RECURSIVE = yes
 
 # The EXCLUDE tag can be used to specify files and/or directories that should
 # excluded from the INPUT source files. This way you can easily exclude a
 # subdirectory from a directory tree whose root is specified with the INPUT tag.
 
-EXCLUDE                = 
+EXCLUDE = 
 
 # The EXCLUDE_SYMLINKS tag can be used select whether or not files or
 # directories that are symbolic links (a Unix filesystem feature) are excluded
 # from the input.
 
-EXCLUDE_SYMLINKS       = NO
+EXCLUDE_SYMLINKS = NO
 
 # If the value of the INPUT tag contains directories, you can use the
 # EXCLUDE_PATTERNS tag to specify one or more wildcard patterns to exclude
@@ -668,7 +611,7 @@ EXCLUDE_SYMLINKS       = NO
 # against the file with absolute path, so to exclude all test directories
 # for example use the pattern */test/*
 
-EXCLUDE_PATTERNS       =
+EXCLUDE_PATTERNS = 
 
 # The EXCLUDE_SYMBOLS tag can be used to specify one or more symbol names
 # (namespaces, classes, functions, etc.) that should be excluded from the
@@ -676,33 +619,33 @@ EXCLUDE_PATTERNS       =
 # wildcard * is used, a substring. Examples: ANamespace, AClass,
 # AClass::ANamespace, ANamespace::*Test
 
-EXCLUDE_SYMBOLS        =
+EXCLUDE_SYMBOLS = 
 
 # The EXAMPLE_PATH tag can be used to specify one or more files or
 # directories that contain example code fragments that are included (see
 # the \include command).
 
-EXAMPLE_PATH           =
+EXAMPLE_PATH = 
 
 # If the value of the EXAMPLE_PATH tag contains directories, you can use the
 # EXAMPLE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp
 # and *.h) to filter out the source-files in the directories. If left
 # blank all files are included.
 
-EXAMPLE_PATTERNS       = *
+EXAMPLE_PATTERNS = *
 
 # If the EXAMPLE_RECURSIVE tag is set to YES then subdirectories will be
 # searched for input files to be used with the \include or \dontinclude
 # commands irrespective of the value of the RECURSIVE tag.
 # Possible values are YES and NO. If left blank NO is used.
 
-EXAMPLE_RECURSIVE      = NO
+EXAMPLE_RECURSIVE = NO
 
 # The IMAGE_PATH tag can be used to specify one or more files or
 # directories that contain image that are included in the documentation (see
 # the \image command).
 
-IMAGE_PATH             =
+IMAGE_PATH = 
 
 # The INPUT_FILTER tag can be used to specify a program that doxygen should
 # invoke to filter for each input file. Doxygen will invoke the filter program
@@ -713,7 +656,7 @@ IMAGE_PATH             =
 # If FILTER_PATTERNS is specified, this tag will be
 # ignored.
 
-INPUT_FILTER           =
+INPUT_FILTER = 
 
 # The FILTER_PATTERNS tag can be used to specify filters on a per file pattern
 # basis.
@@ -724,13 +667,13 @@ INPUT_FILTER           =
 # info on how filters are used. If FILTER_PATTERNS is empty, INPUT_FILTER
 # is applied to all files.
 
-FILTER_PATTERNS        =
+FILTER_PATTERNS = 
 
 # If the FILTER_SOURCE_FILES tag is set to YES, the input filter (if set using
 # INPUT_FILTER) will be used to filter the input files when producing source
 # files to browse (i.e. when SOURCE_BROWSER is set to YES).
 
-FILTER_SOURCE_FILES    = NO
+FILTER_SOURCE_FILES = NO
 
 #---------------------------------------------------------------------------
 # configuration options related to source browsing
@@ -741,18 +684,18 @@ FILTER_SOURCE_FILES    = NO
 # Note: To get rid of all source code in the generated output, make sure also
 # VERBATIM_HEADERS is set to NO.
 
-SOURCE_BROWSER         = NO
+SOURCE_BROWSER = NO
 
 # Setting the INLINE_SOURCES tag to YES will include the body
 # of functions and classes directly in the documentation.
 
-INLINE_SOURCES         = NO
+INLINE_SOURCES = NO
 
 # Setting the STRIP_CODE_COMMENTS tag to YES (the default) will instruct
 # doxygen to hide any special comment blocks from generated source code
 # fragments. Normal C and C++ comments will always remain visible.
 
-STRIP_CODE_COMMENTS    = YES
+STRIP_CODE_COMMENTS = YES
 
 # If the REFERENCED_BY_RELATION tag is set to YES
 # then for each documented function all documented
@@ -764,7 +707,7 @@ REFERENCED_BY_RELATION = YES
 # then for each documented function all documented entities
 # called/used by that function will be listed.
 
-REFERENCES_RELATION    = YES
+REFERENCES_RELATION = YES
 
 # If the REFERENCES_LINK_SOURCE tag is set to YES (the default)
 # and SOURCE_BROWSER tag is set to YES, then the hyperlinks from
@@ -780,13 +723,13 @@ REFERENCES_LINK_SOURCE = YES
 # tagging system (see http://www.gnu.org/software/global/global.html). You
 # will need version 4.8.6 or higher.
 
-USE_HTAGS              = NO
+USE_HTAGS = NO
 
 # If the VERBATIM_HEADERS tag is set to YES (the default) then Doxygen
 # will generate a verbatim copy of the header file for each class for
 # which an include is specified. Set to NO to disable this.
 
-VERBATIM_HEADERS       = NO
+VERBATIM_HEADERS = NO
 
 #---------------------------------------------------------------------------
 # configuration options related to the alphabetical class index
@@ -796,20 +739,20 @@ VERBATIM_HEADERS       = NO
 # of all compounds will be generated. Enable this if the project
 # contains a lot of classes, structs, unions or interfaces.
 
-ALPHABETICAL_INDEX     = NO
+ALPHABETICAL_INDEX = NO
 
 # If the alphabetical index is enabled (see ALPHABETICAL_INDEX) then
 # the COLS_IN_ALPHA_INDEX tag can be used to specify the number of columns
 # in which this list will be split (can be a number in the range [1..20])
 
-COLS_IN_ALPHA_INDEX    = 5
+COLS_IN_ALPHA_INDEX = 5
 
 # In case all classes in a project start with a common prefix, all
 # classes will be put under the same header in the alphabetical index.
 # The IGNORE_PREFIX tag can be used to specify one or more prefixes that
 # should be ignored while generating the index headers.
 
-IGNORE_PREFIX          =
+IGNORE_PREFIX = 
 
 #---------------------------------------------------------------------------
 # configuration options related to the HTML output
@@ -818,36 +761,36 @@ IGNORE_PREFIX          =
 # If the GENERATE_HTML tag is set to YES (the default) Doxygen will
 # generate HTML output.
 
-GENERATE_HTML          = YES
+GENERATE_HTML = YES
 
 # The HTML_OUTPUT tag is used to specify where the HTML docs will be put.
 # If a relative path is entered the value of OUTPUT_DIRECTORY will be
 # put in front of it. If left blank `html' will be used as the default path.
 
-HTML_OUTPUT            = htdocs
+HTML_OUTPUT = htdocs
 
 # The HTML_FILE_EXTENSION tag can be used to specify the file extension for
 # each generated HTML page (for example: .htm,.php,.asp). If it is left blank
 # doxygen will generate files with .html extension.
 
-HTML_FILE_EXTENSION    = .html
+HTML_FILE_EXTENSION = .html
 
 # The HTML_HEADER tag can be used to specify a personal HTML header for
 # each generated HTML page. If it is left blank doxygen will generate a
 # standard header.
 
-HTML_HEADER            =
+HTML_HEADER = 
 
 # The HTML_FOOTER tag can be used to specify a personal HTML footer for
 # each generated HTML page. If it is left blank doxygen will generate a
 # standard footer.
 
-HTML_FOOTER            = footer.html
+HTML_FOOTER = footer.html
 
 # If the HTML_TIMESTAMP tag is set to YES then the generated HTML
 # documentation will contain the timesstamp.
 
-HTML_TIMESTAMP         = NO
+HTML_TIMESTAMP = NO
 
 # The HTML_STYLESHEET tag can be used to specify a user-defined cascading
 # style sheet that is used by each HTML page. It can be used to
@@ -856,13 +799,13 @@ HTML_TIMESTAMP         = NO
 # the style sheet file to the HTML output directory, so don't put your own
 # stylesheet in the HTML output directory as well, or it will be erased!
 
-HTML_STYLESHEET        = libpdfdoc.css
+HTML_STYLESHEET = libpdfdoc.css
 
 # If the HTML_ALIGN_MEMBERS tag is set to YES, the members of classes,
 # files or namespaces will be aligned in HTML using tables. If set to
 # NO a bullet list will be used.
 
-HTML_ALIGN_MEMBERS     = YES
+HTML_ALIGN_MEMBERS = YES
 
 # If the HTML_DYNAMIC_SECTIONS tag is set to YES then the generated HTML
 # documentation will contain sections that can be hidden and shown after the
@@ -870,7 +813,7 @@ HTML_ALIGN_MEMBERS     = YES
 # JavaScript and DHTML is required (for instance Mozilla 1.0+, Firefox
 # Netscape 6.0+, Internet explorer 5.0+, Konqueror, or Safari).
 
-HTML_DYNAMIC_SECTIONS  = NO
+HTML_DYNAMIC_SECTIONS = NO
 
 # If the GENERATE_DOCSET tag is set to YES, additional index files
 # will be generated that can be used as input for Apple's Xcode 3
@@ -882,125 +825,125 @@ HTML_DYNAMIC_SECTIONS  = NO
 # it at startup.
 # See http://developer.apple.com/tools/creatingdocsetswithdoxygen.html for more information.
 
-GENERATE_DOCSET        = NO
+GENERATE_DOCSET = NO
 
 # When GENERATE_DOCSET tag is set to YES, this tag determines the name of the
 # feed. A documentation feed provides an umbrella under which multiple
 # documentation sets from a single provider (such as a company or product suite)
 # can be grouped.
 
-DOCSET_FEEDNAME        = "Doxygen generated docs"
+DOCSET_FEEDNAME = "Doxygen generated docs"
 
 # When GENERATE_DOCSET tag is set to YES, this tag specifies a string that
 # should uniquely identify the documentation set bundle. This should be a
 # reverse domain-name style string, e.g. com.mycompany.MyDocSet. Doxygen
 # will append .docset to the name.
 
-DOCSET_BUNDLE_ID       = org.doxygen.Project
+DOCSET_BUNDLE_ID = org.doxygen.Project
 
 # If the GENERATE_HTMLHELP tag is set to YES, additional index files
 # will be generated that can be used as input for tools like the
 # Microsoft HTML help workshop to generate a compiled HTML help file (.chm)
 # of the generated HTML documentation.
 
-GENERATE_HTMLHELP      = NO
+GENERATE_HTMLHELP = NO
 
 # If the GENERATE_HTMLHELP tag is set to YES, the CHM_FILE tag can
 # be used to specify the file name of the resulting .chm file. You
 # can add a path in front of the file if the result should not be
 # written to the html output directory.
 
-CHM_FILE               =
+CHM_FILE = 
 
 # If the GENERATE_HTMLHELP tag is set to YES, the HHC_LOCATION tag can
 # be used to specify the location (absolute path including file name) of
 # the HTML help compiler (hhc.exe). If non-empty doxygen will try to run
 # the HTML help compiler on the generated index.hhp.
 
-HHC_LOCATION           =
+HHC_LOCATION = 
 
 # If the GENERATE_HTMLHELP tag is set to YES, the GENERATE_CHI flag
 # controls if a separate .chi index file is generated (YES) or that
 # it should be included in the master .chm file (NO).
 
-GENERATE_CHI           = NO
+GENERATE_CHI = NO
 
 # If the GENERATE_HTMLHELP tag is set to YES, the CHM_INDEX_ENCODING
 # is used to encode HtmlHelp index (hhk), content (hhc) and project file
 # content.
 
-CHM_INDEX_ENCODING     =
+CHM_INDEX_ENCODING = 
 
 # If the GENERATE_HTMLHELP tag is set to YES, the BINARY_TOC flag
 # controls whether a binary table of contents is generated (YES) or a
 # normal table of contents (NO) in the .chm file.
 
-BINARY_TOC             = NO
+BINARY_TOC = NO
 
 # The TOC_EXPAND flag can be set to YES to add extra items for group members
 # to the contents of the HTML help documentation and to the tree view.
 
-TOC_EXPAND             = NO
+TOC_EXPAND = NO
 
 # If the GENERATE_QHP tag is set to YES and both QHP_NAMESPACE and QHP_VIRTUAL_FOLDER
 # are set, an additional index file will be generated that can be used as input for
 # Qt's qhelpgenerator to generate a Qt Compressed Help (.qch) of the generated
 # HTML documentation.
 
-GENERATE_QHP           = NO
+GENERATE_QHP = NO
 
 # If the QHG_LOCATION tag is specified, the QCH_FILE tag can
 # be used to specify the file name of the resulting .qch file.
 # The path specified is relative to the HTML output folder.
 
-QCH_FILE               =
+QCH_FILE = 
 
 # The QHP_NAMESPACE tag specifies the namespace to use when generating
 # Qt Help Project output. For more information please see
 # http://doc.trolltech.com/qthelpproject.html#namespace
 
-QHP_NAMESPACE          =
+QHP_NAMESPACE = 
 
 # The QHP_VIRTUAL_FOLDER tag specifies the namespace to use when generating
 # Qt Help Project output. For more information please see
 # http://doc.trolltech.com/qthelpproject.html#virtual-folders
 
-QHP_VIRTUAL_FOLDER     = doc
+QHP_VIRTUAL_FOLDER = doc
 
 # If QHP_CUST_FILTER_NAME is set, it specifies the name of a custom filter to add.
 # For more information please see
 # http://doc.trolltech.com/qthelpproject.html#custom-filters
 
-QHP_CUST_FILTER_NAME   =
+QHP_CUST_FILTER_NAME = 
 
 # The QHP_CUST_FILT_ATTRS tag specifies the list of the attributes of the custom filter to add.For more information please see
 # <a href="http://doc.trolltech.com/qthelpproject.html#custom-filters">Qt Help Project / Custom Filters</a>.
 
-QHP_CUST_FILTER_ATTRS  =
+QHP_CUST_FILTER_ATTRS = 
 
 # The QHP_SECT_FILTER_ATTRS tag specifies the list of the attributes this project's
 # filter section matches.
 # <a href="http://doc.trolltech.com/qthelpproject.html#filter-attributes">Qt Help Project / Filter Attributes</a>.
 
-QHP_SECT_FILTER_ATTRS  =
+QHP_SECT_FILTER_ATTRS = 
 
 # If the GENERATE_QHP tag is set to YES, the QHG_LOCATION tag can
 # be used to specify the location of Qt's qhelpgenerator.
 # If non-empty doxygen will try to run qhelpgenerator on the generated
 # .qhp file.
 
-QHG_LOCATION           =
+QHG_LOCATION = 
 
 # The DISABLE_INDEX tag can be used to turn on/off the condensed index at
 # top of each HTML page. The value NO (the default) enables the index and
 # the value YES disables it.
 
-DISABLE_INDEX          = NO
+DISABLE_INDEX = NO
 
 # This tag can be used to set the number of enum values (range [1..20])
 # that doxygen will group on one line in the generated HTML documentation.
 
-ENUM_VALUES_PER_LINE   = 4
+ENUM_VALUES_PER_LINE = 4
 
 # The GENERATE_TREEVIEW tag is used to specify whether a tree-like index
 # structure should be generated to display hierarchical information.
@@ -1010,18 +953,18 @@ ENUM_VALUES_PER_LINE   = 4
 # JavaScript, DHTML, CSS and frames is required (i.e. any modern browser).
 # Windows users are probably better off using the HTML help feature.
 
-GENERATE_TREEVIEW      = NO
+GENERATE_TREEVIEW = NO
 
 # By enabling USE_INLINE_TREES, doxygen will generate the Groups, Directories,
 # and Class Hierarchy pages using a tree view instead of an ordered list.
 
-USE_INLINE_TREES       = NO
+USE_INLINE_TREES = NO
 
 # If the treeview is enabled (see GENERATE_TREEVIEW) then this tag can be
 # used to set the initial width (in pixels) of the frame in which the tree
 # is shown.
 
-TREEVIEW_WIDTH         = 250
+TREEVIEW_WIDTH = 250
 
 # Use this tag to change the font size of Latex formulas included
 # as images in the HTML documentation. The default is 10. Note that
@@ -1029,14 +972,14 @@ TREEVIEW_WIDTH         = 250
 # to manually remove any form_*.png images from the HTML output directory
 # to force them to be regenerated.
 
-FORMULA_FONTSIZE       = 10
+FORMULA_FONTSIZE = 10
 
 # When the SEARCHENGINE tag is enable doxygen will generate a search box for the HTML output. The underlying search engine uses javascript
 # and DHTML and should work on any modern browser. Note that when using HTML help (GENERATE_HTMLHELP) or Qt help (GENERATE_QHP)
 # there is already a search function so this one should typically
 # be disabled.
 
-SEARCHENGINE           = NO
+SEARCHENGINE = NO
 
 #---------------------------------------------------------------------------
 # configuration options related to the LaTeX output
@@ -1045,78 +988,78 @@ SEARCHENGINE           = NO
 # If the GENERATE_LATEX tag is set to YES (the default) Doxygen will
 # generate Latex output.
 
-GENERATE_LATEX         = NO
+GENERATE_LATEX = NO
 
 # The LATEX_OUTPUT tag is used to specify where the LaTeX docs will be put.
 # If a relative path is entered the value of OUTPUT_DIRECTORY will be
 # put in front of it. If left blank `latex' will be used as the default path.
 
-LATEX_OUTPUT           = latex
+LATEX_OUTPUT = latex
 
 # The LATEX_CMD_NAME tag can be used to specify the LaTeX command name to be
 # invoked. If left blank `latex' will be used as the default command name.
 
-LATEX_CMD_NAME         = latex
+LATEX_CMD_NAME = latex
 
 # The MAKEINDEX_CMD_NAME tag can be used to specify the command name to
 # generate index for LaTeX. If left blank `makeindex' will be used as the
 # default command name.
 
-MAKEINDEX_CMD_NAME     = makeindex
+MAKEINDEX_CMD_NAME = makeindex
 
 # If the COMPACT_LATEX tag is set to YES Doxygen generates more compact
 # LaTeX documents. This may be useful for small projects and may help to
 # save some trees in general.
 
-COMPACT_LATEX          = NO
+COMPACT_LATEX = NO
 
 # The PAPER_TYPE tag can be used to set the paper type that is used
 # by the printer. Possible values are: a4, a4wide, letter, legal and
 # executive. If left blank a4wide will be used.
 
-PAPER_TYPE             = a4wide
+PAPER_TYPE = a4wide
 
 # The EXTRA_PACKAGES tag can be to specify one or more names of LaTeX
 # packages that should be included in the LaTeX output.
 
-EXTRA_PACKAGES         =
+EXTRA_PACKAGES = 
 
 # The LATEX_HEADER tag can be used to specify a personal LaTeX header for
 # the generated latex document. The header should contain everything until
 # the first chapter. If it is left blank doxygen will generate a
 # standard header. Notice: only use this tag if you know what you are doing!
 
-LATEX_HEADER           =
+LATEX_HEADER = 
 
 # If the PDF_HYPERLINKS tag is set to YES, the LaTeX that is generated
 # is prepared for conversion to pdf (using ps2pdf). The pdf file will
 # contain links (just like the HTML output) instead of page references
 # This makes the output suitable for online browsing using a pdf viewer.
 
-PDF_HYPERLINKS         = YES
+PDF_HYPERLINKS = YES
 
 # If the USE_PDFLATEX tag is set to YES, pdflatex will be used instead of
 # plain latex in the generated Makefile. Set this option to YES to get a
 # higher quality PDF documentation.
 
-USE_PDFLATEX           = YES
+USE_PDFLATEX = YES
 
 # If the LATEX_BATCHMODE tag is set to YES, doxygen will add the \\batchmode.
 # command to the generated LaTeX files. This will instruct LaTeX to keep
 # running if errors occur, instead of asking the user for help.
 # This option is also used when generating formulas in HTML.
 
-LATEX_BATCHMODE        = NO
+LATEX_BATCHMODE = NO
 
 # If LATEX_HIDE_INDICES is set to YES then doxygen will not
 # include the index chapters (such as File Index, Compound Index, etc.)
 # in the output.
 
-LATEX_HIDE_INDICES     = NO
+LATEX_HIDE_INDICES = NO
 
 # If LATEX_SOURCE_CODE is set to YES then doxygen will include source code with syntax highlighting in the LaTeX output. Note that which sources are shown also depends on other settings such as SOURCE_BROWSER.
 
-LATEX_SOURCE_CODE      = NO
+LATEX_SOURCE_CODE = NO
 
 #---------------------------------------------------------------------------
 # configuration options related to the RTF output
@@ -1126,19 +1069,19 @@ LATEX_SOURCE_CODE      = NO
 # The RTF output is optimized for Word 97 and may not look very pretty with
 # other RTF readers or editors.
 
-GENERATE_RTF           = NO
+GENERATE_RTF = NO
 
 # The RTF_OUTPUT tag is used to specify where the RTF docs will be put.
 # If a relative path is entered the value of OUTPUT_DIRECTORY will be
 # put in front of it. If left blank `rtf' will be used as the default path.
 
-RTF_OUTPUT             = rtf
+RTF_OUTPUT = rtf
 
 # If the COMPACT_RTF tag is set to YES Doxygen generates more compact
 # RTF documents. This may be useful for small projects and may help to
 # save some trees in general.
 
-COMPACT_RTF            = NO
+COMPACT_RTF = NO
 
 # If the RTF_HYPERLINKS tag is set to YES, the RTF that is generated
 # will contain hyperlink fields. The RTF file will
@@ -1147,18 +1090,18 @@ COMPACT_RTF            = NO
 # programs which support those fields.
 # Note: wordpad (write) and others do not support links.
 
-RTF_HYPERLINKS         = NO
+RTF_HYPERLINKS = NO
 
 # Load stylesheet definitions from file. Syntax is similar to doxygen's
 # config file, i.e. a series of assignments. You only have to provide
 # replacements, missing definitions are set to their default value.
 
-RTF_STYLESHEET_FILE    =
+RTF_STYLESHEET_FILE = 
 
 # Set optional variables used in the generation of an rtf document.
 # Syntax is similar to doxygen's config file.
 
-RTF_EXTENSIONS_FILE    =
+RTF_EXTENSIONS_FILE = 
 
 #---------------------------------------------------------------------------
 # configuration options related to the man page output
@@ -1167,18 +1110,18 @@ RTF_EXTENSIONS_FILE    =
 # If the GENERATE_MAN tag is set to YES (the default) Doxygen will
 # generate man pages
 
-GENERATE_MAN           = NO
+GENERATE_MAN = NO
 
 # The MAN_OUTPUT tag is used to specify where the man pages will be put.
 # If a relative path is entered the value of OUTPUT_DIRECTORY will be
 # put in front of it. If left blank `man' will be used as the default path.
 
-MAN_OUTPUT             = man
+MAN_OUTPUT = man
 
 # The MAN_EXTENSION tag determines the extension that is added to
 # the generated man pages (default is the subroutine's section .3)
 
-MAN_EXTENSION          = .3
+MAN_EXTENSION = .3
 
 # If the MAN_LINKS tag is set to YES and Doxygen generates man output,
 # then it will generate one additional man file for each entity
@@ -1186,7 +1129,7 @@ MAN_EXTENSION          = .3
 # only source the real man page, but without them the man command
 # would be unable to find the correct page. The default is NO.
 
-MAN_LINKS              = NO
+MAN_LINKS = NO
 
 #---------------------------------------------------------------------------
 # configuration options related to the XML output
@@ -1196,32 +1139,32 @@ MAN_LINKS              = NO
 # generate an XML file that captures the structure of
 # the code including all documentation.
 
-GENERATE_XML           = NO
+GENERATE_XML = NO
 
 # The XML_OUTPUT tag is used to specify where the XML pages will be put.
 # If a relative path is entered the value of OUTPUT_DIRECTORY will be
 # put in front of it. If left blank `xml' will be used as the default path.
 
-XML_OUTPUT             = xml
+XML_OUTPUT = xml
 
 # The XML_SCHEMA tag can be used to specify an XML schema,
 # which can be used by a validating XML parser to check the
 # syntax of the XML files.
 
-XML_SCHEMA             =
+XML_SCHEMA = 
 
 # The XML_DTD tag can be used to specify an XML DTD,
 # which can be used by a validating XML parser to check the
 # syntax of the XML files.
 
-XML_DTD                =
+XML_DTD = 
 
 # If the XML_PROGRAMLISTING tag is set to YES Doxygen will
 # dump the program listings (including syntax highlighting
 # and cross-referencing information) to the XML output. Note that
 # enabling this will significantly increase the size of the XML output.
 
-XML_PROGRAMLISTING     = YES
+XML_PROGRAMLISTING = YES
 
 #---------------------------------------------------------------------------
 # configuration options for the AutoGen Definitions output
@@ -1233,7 +1176,7 @@ XML_PROGRAMLISTING     = YES
 # documentation. Note that this feature is still experimental
 # and incomplete at the moment.
 
-GENERATE_AUTOGEN_DEF   = NO
+GENERATE_AUTOGEN_DEF = NO
 
 #---------------------------------------------------------------------------
 # configuration options related to the Perl module output
@@ -1245,13 +1188,13 @@ GENERATE_AUTOGEN_DEF   = NO
 # feature is still experimental and incomplete at the
 # moment.
 
-GENERATE_PERLMOD       = NO
+GENERATE_PERLMOD = NO
 
 # If the PERLMOD_LATEX tag is set to YES Doxygen will generate
 # the necessary Makefile rules, Perl scripts and LaTeX code to be able
 # to generate PDF and DVI output from the Perl module output.
 
-PERLMOD_LATEX          = NO
+PERLMOD_LATEX = NO
 
 # If the PERLMOD_PRETTY tag is set to YES the Perl module output will be
 # nicely formatted so it can be parsed by a human reader.
@@ -1261,14 +1204,14 @@ PERLMOD_LATEX          = NO
 # tag is set to NO the size of the Perl module output will be much smaller
 # and Perl will parse it just the same.
 
-PERLMOD_PRETTY         = YES
+PERLMOD_PRETTY = YES
 
 # The names of the make variables in the generated doxyrules.make file
 # are prefixed with the string contained in PERLMOD_MAKEVAR_PREFIX.
 # This is useful so different doxyrules.make files included by the same
 # Makefile don't overwrite each other's variables.
 
-PERLMOD_MAKEVAR_PREFIX =
+PERLMOD_MAKEVAR_PREFIX = 
 
 #---------------------------------------------------------------------------
 # Configuration options related to the preprocessor
@@ -1278,38 +1221,38 @@ PERLMOD_MAKEVAR_PREFIX =
 # evaluate all C-preprocessor directives found in the sources and include
 # files.
 
-ENABLE_PREPROCESSING   = YES
+ENABLE_PREPROCESSING = YES
 
 # If the MACRO_EXPANSION tag is set to YES Doxygen will expand all macro
 # names in the source code. If set to NO (the default) only conditional
 # compilation will be performed. Macro expansion can be done in a controlled
 # way by setting EXPAND_ONLY_PREDEF to YES.
 
-MACRO_EXPANSION        = NO
+MACRO_EXPANSION = NO
 
 # If the EXPAND_ONLY_PREDEF and MACRO_EXPANSION tags are both set to YES
 # then the macro expansion is limited to the macros specified with the
 # PREDEFINED and EXPAND_AS_DEFINED tags.
 
-EXPAND_ONLY_PREDEF     = NO
+EXPAND_ONLY_PREDEF = NO
 
 # If the SEARCH_INCLUDES tag is set to YES (the default) the includes files
 # in the INCLUDE_PATH (see below) will be search if a #include is found.
 
-SEARCH_INCLUDES        = YES
+SEARCH_INCLUDES = YES
 
 # The INCLUDE_PATH tag can be used to specify one or more directories that
 # contain include files that are not input files but should be processed by
 # the preprocessor.
 
-INCLUDE_PATH           =
+INCLUDE_PATH = 
 
 # You can use the INCLUDE_FILE_PATTERNS tag to specify one or more wildcard
 # patterns (like *.h and *.hpp) to filter out the header-files in the
 # directories. If left blank, the patterns specified with FILE_PATTERNS will
 # be used.
 
-INCLUDE_FILE_PATTERNS  =
+INCLUDE_FILE_PATTERNS = 
 
 # The PREDEFINED tag can be used to specify one or more macro names that
 # are defined before the preprocessor is started (similar to the -D option of
@@ -1319,14 +1262,14 @@ INCLUDE_FILE_PATTERNS  =
 # undefined via #undef or recursively expanded use the := operator
 # instead of the = operator.
 
-PREDEFINED             =
+PREDEFINED = 
 
 # If the MACRO_EXPANSION and EXPAND_ONLY_PREDEF tags are set to YES then
 # this tag can be used to specify a list of macro names that should be expanded.
 # The macro definition that is found in the sources will be used.
 # Use the PREDEFINED tag if you want to use a different macro definition.
 
-EXPAND_AS_DEFINED      =
+EXPAND_AS_DEFINED = 
 
 # If the SKIP_FUNCTION_MACROS tag is set to YES (the default) then
 # doxygen's preprocessor will remove all function-like macros that are alone
@@ -1334,7 +1277,7 @@ EXPAND_AS_DEFINED      =
 # function macros are typically used for boiler-plate code, and will confuse
 # the parser if not removed.
 
-SKIP_FUNCTION_MACROS   = YES
+SKIP_FUNCTION_MACROS = YES
 
 #---------------------------------------------------------------------------
 # Configuration::additions related to external references
@@ -1357,29 +1300,29 @@ SKIP_FUNCTION_MACROS   = YES
 # If a tag file is not located in the directory in which doxygen
 # is run, you must also specify the path to the tagfile here.
 
-TAGFILES               =
+TAGFILES = 
 
 # When a file name is specified after GENERATE_TAGFILE, doxygen will create
 # a tag file that is based on the input files it reads.
 
-GENERATE_TAGFILE       = libpdfdoc.tag
+GENERATE_TAGFILE = libpdfdoc.tag
 
 # If the ALLEXTERNALS tag is set to YES all external classes will be listed
 # in the class index. If set to NO only the inherited external classes
 # will be listed.
 
-ALLEXTERNALS           = NO
+ALLEXTERNALS = NO
 
 # If the EXTERNAL_GROUPS tag is set to YES all external groups will be listed
 # in the modules index. If set to NO, only the current project's groups will
 # be listed.
 
-EXTERNAL_GROUPS        = YES
+EXTERNAL_GROUPS = YES
 
 # The PERL_PATH should be the absolute path and name of the perl script
 # interpreter (i.e. the result of `which perl').
 
-PERL_PATH              = /usr/bin/perl
+PERL_PATH = /usr/bin/perl
 
 #---------------------------------------------------------------------------
 # Configuration options related to the dot tool
@@ -1392,7 +1335,7 @@ PERL_PATH              = /usr/bin/perl
 # fallback. It is recommended to install and use dot, since it yields more
 # powerful graphs.
 
-CLASS_DIAGRAMS         = NO
+CLASS_DIAGRAMS = NO
 
 # You can define message sequence charts within doxygen comments using the \msc
 # command. Doxygen will then run the mscgen tool (see
@@ -1401,20 +1344,20 @@ CLASS_DIAGRAMS         = NO
 # the mscgen tool resides. If left empty the tool is assumed to be found in the
 # default search path.
 
-MSCGEN_PATH            =
+MSCGEN_PATH = 
 
 # If set to YES, the inheritance and collaboration graphs will hide
 # inheritance and usage relations if the target is undocumented
 # or is not a class.
 
-HIDE_UNDOC_RELATIONS   = YES
+HIDE_UNDOC_RELATIONS = YES
 
 # If you set the HAVE_DOT tag to YES then doxygen will assume the dot tool is
 # available from the path. This tool is part of Graphviz, a graph visualization
 # toolkit from AT&T and Lucent Bell Labs. The other options in this section
 # have no effect if this option is set to NO (the default)
 
-HAVE_DOT               = YES
+HAVE_DOT = YES
 
 # By default doxygen will write a font called FreeSans.ttf to the output
 # directory and reference it in all dot files that doxygen generates. This
@@ -1425,63 +1368,63 @@ HAVE_DOT               = YES
 # DOTFONTPATH environment variable or by setting DOT_FONTPATH to the directory
 # containing the font.
 
-DOT_FONTNAME           = FreeSans
+DOT_FONTNAME = FreeSans
 
 # The DOT_FONTSIZE tag can be used to set the size of the font of dot graphs.
 # The default size is 10pt.
 
-DOT_FONTSIZE           = 10
+DOT_FONTSIZE = 10
 
 # By default doxygen will tell dot to use the output directory to look for the
 # FreeSans.ttf font (which doxygen will put there itself). If you specify a
 # different font using DOT_FONTNAME you can set the path where dot
 # can find it using this tag.
 
-DOT_FONTPATH           =
+DOT_FONTPATH = 
 
 # If the CLASS_GRAPH and HAVE_DOT tags are set to YES then doxygen
 # will generate a graph for each documented class showing the direct and
 # indirect inheritance relations. Setting this tag to YES will force the
 # the CLASS_DIAGRAMS tag to NO.
 
-CLASS_GRAPH            = YES
+CLASS_GRAPH = YES
 
 # If the COLLABORATION_GRAPH and HAVE_DOT tags are set to YES then doxygen
 # will generate a graph for each documented class showing the direct and
 # indirect implementation dependencies (inheritance, containment, and
 # class references variables) of the class with other documented classes.
 
-COLLABORATION_GRAPH    = YES
+COLLABORATION_GRAPH = YES
 
 # If the GROUP_GRAPHS and HAVE_DOT tags are set to YES then doxygen
 # will generate a graph for groups, showing the direct groups dependencies
 
-GROUP_GRAPHS           = YES
+GROUP_GRAPHS = YES
 
 # If the UML_LOOK tag is set to YES doxygen will generate inheritance and
 # collaboration diagrams in a style similar to the OMG's Unified Modeling
 # Language.
 
-UML_LOOK               = YES
+UML_LOOK = YES
 
 # If set to YES, the inheritance and collaboration graphs will show the
 # relations between templates and their instances.
 
-TEMPLATE_RELATIONS     = NO
+TEMPLATE_RELATIONS = NO
 
 # If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDE_GRAPH, and HAVE_DOT
 # tags are set to YES then doxygen will generate a graph for each documented
 # file showing the direct and indirect include dependencies of the file with
 # other documented files.
 
-INCLUDE_GRAPH          = YES
+INCLUDE_GRAPH = YES
 
 # If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDED_BY_GRAPH, and
 # HAVE_DOT tags are set to YES then doxygen will generate a graph for each
 # documented header file showing the documented files that directly or
 # indirectly include this file.
 
-INCLUDED_BY_GRAPH      = YES
+INCLUDED_BY_GRAPH = YES
 
 # If the CALL_GRAPH and HAVE_DOT options are set to YES then
 # doxygen will generate a call dependency graph for every global function
@@ -1489,7 +1432,7 @@ INCLUDED_BY_GRAPH      = YES
 # the time of a run. So in most cases it will be better to enable call graphs
 # for selected functions only using the \callgraph command.
 
-CALL_GRAPH             = YES
+CALL_GRAPH = YES
 
 # If the CALLER_GRAPH and HAVE_DOT tags are set to YES then
 # doxygen will generate a caller dependency graph for every global function
@@ -1497,36 +1440,36 @@ CALL_GRAPH             = YES
 # the time of a run. So in most cases it will be better to enable caller
 # graphs for selected functions only using the \callergraph command.
 
-CALLER_GRAPH           = NO
+CALLER_GRAPH = NO
 
 # If the GRAPHICAL_HIERARCHY and HAVE_DOT tags are set to YES then doxygen
 # will graphical hierarchy of all classes instead of a textual one.
 
-GRAPHICAL_HIERARCHY    = YES
+GRAPHICAL_HIERARCHY = YES
 
 # If the DIRECTORY_GRAPH, SHOW_DIRECTORIES and HAVE_DOT tags are set to YES
 # then doxygen will show the dependencies a directory has on other directories
 # in a graphical way. The dependency relations are determined by the #include
 # relations between the files in the directories.
 
-DIRECTORY_GRAPH        = YES
+DIRECTORY_GRAPH = YES
 
 # The DOT_IMAGE_FORMAT tag can be used to set the image format of the images
 # generated by dot. Possible values are png, jpg, or gif
 # If left blank png will be used.
 
-DOT_IMAGE_FORMAT       = png
+DOT_IMAGE_FORMAT = png
 
 # The tag DOT_PATH can be used to specify the path where the dot tool can be
 # found. If left blank, it is assumed the dot tool can be found in the path.
 
-DOT_PATH               =
+DOT_PATH = 
 
 # The DOTFILE_DIRS tag can be used to specify one or more directories that
 # contain dot files that are included in the documentation (see the
 # \dotfile command).
 
-DOTFILE_DIRS           =
+DOTFILE_DIRS = 
 
 # The DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of
 # nodes that will be shown in the graph. If the number of nodes in a graph
@@ -1536,7 +1479,7 @@ DOTFILE_DIRS           =
 # DOT_GRAPH_MAX_NODES then the graph will not be shown at all. Also note
 # that the size of a graph can be further restricted by MAX_DOT_GRAPH_DEPTH.
 
-DOT_GRAPH_MAX_NODES    = 1000
+DOT_GRAPH_MAX_NODES = 1000
 
 # The MAX_DOT_GRAPH_DEPTH tag can be used to set the maximum depth of the
 # graphs generated by dot. A depth value of 3 means that only nodes reachable
@@ -1546,7 +1489,7 @@ DOT_GRAPH_MAX_NODES    = 1000
 # code bases. Also note that the size of a graph can be further restricted by
 # DOT_GRAPH_MAX_NODES. Using a depth of 0 means no depth restriction.
 
-MAX_DOT_GRAPH_DEPTH    = 1000
+MAX_DOT_GRAPH_DEPTH = 1000
 
 # Set the DOT_TRANSPARENT tag to YES to generate images with a transparent
 # background. This is disabled by default, because dot on Windows does not
@@ -1554,23 +1497,23 @@ MAX_DOT_GRAPH_DEPTH    = 1000
 # enabling this option may lead to badly anti-aliased labels on the edges of
 # a graph (i.e. they become hard to read).
 
-DOT_TRANSPARENT        = NO
+DOT_TRANSPARENT = NO
 
 # Set the DOT_MULTI_TARGETS tag to YES allow dot to generate multiple output
 # files in one run (i.e. multiple -o and -T options on the command line). This
 # makes dot run faster, but since only newer versions of dot (>1.8.10)
 # support this, this feature is disabled by default.
 
-DOT_MULTI_TARGETS      = NO
+DOT_MULTI_TARGETS = NO
 
 # If the GENERATE_LEGEND tag is set to YES (the default) Doxygen will
 # generate a legend page explaining the meaning of the various boxes and
 # arrows in the dot generated graphs.
 
-GENERATE_LEGEND        = YES
+GENERATE_LEGEND = YES
 
 # If the DOT_CLEANUP tag is set to YES (the default) Doxygen will
 # remove the intermediate dot files that are used to generate
 # the various graphs.
 
-DOT_CLEANUP            = YES
+DOT_CLEANUP = YES
diff --git a/libpdfdoc/doc/MainPage.doxygen b/libpdfdoc/doc/MainPage.doxygen
deleted file mode 100644
index e788829..0000000
--- a/libpdfdoc/doc/MainPage.doxygen
+++ /dev/null
@@ -1,155 +0,0 @@
-/**	\mainpage	libpdfdoc Project Home Page
-	\section	intro	Introduction
-	libpdfdoc is a library to access
-	<a href="http://www.adobe.com/devnet/pdf/pdf_reference.html">PDF (Portable
-	Document Format)</a>. It provides classes
-	and functions for reading and writing to PDF files.
-	
-	\section	features	Features
-	- read/write PDF files with the same API
-	- not much right now
-	
-	\section	license		License
-	libpdfdoc is release under
-	<a href="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">GPL v2</a>.
-	In short, it is <a href="http://www.gnu.org/philosophy/free-sw.html">Free
-	Software</a>. I am not responsible for any damage it may make. You can
-	change it, sell it,	distribute it. As libpdfdoc contains some code borrow
-	from GPL project, the license is GPL v2 as a whole. As it is NOT LGPL,
-	it is not legal to use it in proprietary projects.
-	
-	Note that it is not "GPL v2 or later". The GPL v3 does not apply to this
-	library.
-	
-	\section	get		Getting libpdfdoc
-	libpdfdoc can be downloaded in from
-	<a href="http://sourceforge.net/project/showfiles.php?group_id=14057">
-	sourceforge</a>. The latest snapshot is also available in the
-	<a href="http://libpdfxx.git.sourceforge.net/">git</a> repository hosted
-	in sourceforge. To access the repository, configure you git clients to
-	clone from git://libpdfxx.git.sourceforge.net/gitroot/libpdfxx. See
-	<a href="http://sourceforge.net/projects/libpdfxx/develop">here</a> for more
-	details.
-	
-	\section	depend	Dependencies
-	libpdfdoc depends on the following libraries:
-	- <a href="http://www.boost.org">The Boost Library</a> v1.37 or above
-	- <a href="http://zlib.net">Zlib</a> v1.2.3
-	- <a href="http://www.freetype.org">Freetype</a>
-	- <a href="http://libpng.sourceforge.net/index.html">libpng</a> (Optional)
-	- <a href="http://www.ijg.org/">libjpeg</a> (Optional)
-	- <a href= 
-	"http://apps.sourceforge.net/mediawiki/cppunit/index.php?title=Main_Page">
-	cppunit</a> (Optional)
-	
-	These are available for all major Linux distributions. For Win32 platforms,
-	most of the libraries (zlib, Freetype, libpng) can be downloaded from the
-	<a href="http://gnuwin32.sourceforge.net/">GNU Win32 project</a>. For Boost,
-	<a href="http://www.boostpro.com/download">BoostPro Computing</a> provides
-	pre-built libraries with a nice installer for Win32.
-
-	\section download Download
-	
-	libpdfdoc is available at <a href="https://sourceforge.net/projects/libpdfxx/files/">
-	sourceforge</a>.
-	
-	\section	build	Building libpdfdoc
-	libpdfdoc uses the <a href="http://www.cmake.org/">cmake</a> build system
-	to produce makefiles for different development platforms. The cmake build
-	system will automatically detect the location of the dependency libraries
-	and adjust the include and library path of the project. In most unix-like
-	environment, the command:
-
-\verbatim
-cmake -G 'Unix Makefiles' /path/to/libpdfdoc/
-\endverbatim
-
-	should be enough to generate the makefiles to build the project.
-	It is also possible to use cmake to generate project files of other build
-	environments, e.g. MS Visual Studio or eclipse, depending on your platform.
-	Afterwards, just type \c make to build. cmake by default will not show the
-	actual command line of the compiler. To see it, type this command:
-
-\verbatim
-VERBOSE=1 make
-\endverbatim
-
-	This will show the full command line of the compiler. It is useful for
-	troubleshooting compiler issues.
-
-	cmake also supports Microsoft Visual Studio. Just use a different makefile
-	generator for the version of VS. For example, for VS 2005:
-	
-\verbatim
-cmake -G 'Visual Studio 8 2005' c:\path\to\libpdfdoc\
-\endverbatim
-
-	You may have to add <tt>-DCMAKE_PREFIX_PATH=c:\\path\\to\\libraries</tt>
-	to the cmake command line to make sure it can find the library
-	dependencies. You can also use
-	<tt>-DBOOST_ROOT=c:\\path\\to\\boost\\library</tt> to specify
-	the path to the boost library.
-
-	cmake recommends separating the source code directory and the build
-	directory. Suppose the libpdfdoc source code is located at
-	<tt>c:\\code\\libpdfdoc</tt>, and you want to create the VS project files
-	at <tt>c:\\build\\libpdfdoc</tt>, you may want to run the following
-	commands:
-	
-\verbatim
-C:\build\libpdfdoc>cmake -G "Visual Studio 8 2005" \
-                         -DBOOST_ROOT=c:\path\to\boost\library \
-                         -DCMAKE_PREFIX_PATH=c:\path\to\other\libraries \
-                         -DCPPUNIT_PREFIX=c:\path\to\cppunit \
-                         c:\code\libpdfdoc
-\endverbatim
-
-	\section links Links
-	- <a href="http://gitorious.org/libpdfxx/pages/Home">Project Wiki</a>
-	- <a href="http://www.cmake.org/cmake/help/documentation.html">cmake
-	documentation</a>
-
-	See the \ref getting_start page for a simple tutorial for using the
-	library.
-*/
-/**	\page	getting_start	Getting Started
-	
-	This section will describe how to write a simplest "Hello world" program
-	with libpdfdoc.
-
-	Let's start with the following code:
-
-\code
-pdf::Doc *doc = pdf::CreateDoc( ) ;
-pdf::Page *p = doc->AppendPage( ) ;
-pdf::Font *f = doc->CreateSimpleFont( "Arial" ) ;
-
-pdf::PageContent *c = p->GetContent( ) ;
-pdf::Text *t = c->AddText( 12.0, f ) ;
-t->AddLine( 100, 100, L"Hello world!" ) ;
-
-doc->Write( "helloworld.pdf" ) ;
-delete doc ;
-\endcode
-
-	The first line creates a PDF document. The CreateDoc() function will
-	create a Doc object, which represents a PDF document. The Doc object
-	provides functions to access the document content. It has member functions
-	to get the individual pages of the document.
-	
-	The second line call pdf::Doc::AppendPage() to insert a new page at the end
-	of the document.
-*/
-/**	\page	pdf_note	PDF Implementation Note
-
-	The aim of this page is to document the PDF implementation in libpdf++.
-	In some aspect, libpdf++ does not stictly follow the behaviour specified
-	by the
-	<a href="http://www.adobe.com/devnet/pdf/pdf_reference.html">PDF
-	Specification</a>. It is because to maintain compatibility with other
-	existing PDF software, or more specifically, acrobat reader.
-	
-	-	Some fields are defined as "Required" are not actually required.
-		Acrobat reader can still correctly read the document. Examples includes:
-		* the /Type field for fonts.	  	
-*/
diff --git a/libpdfdoc/include/font/Font.hh b/libpdfdoc/include/font/Font.hh
index c0931f3..3d3180e 100644
--- a/libpdfdoc/include/font/Font.hh
+++ b/libpdfdoc/include/font/Font.hh
@@ -60,7 +60,9 @@ public :
 	/// Return the base name of a font.
 	/**	This function returns the PostScript name of the font. For Type 1 fonts,
 		this is usually the value of the FontName entry in the font program.
-		For TrueType fonts, it is returned by the FT_Get_Postscript_Name()
+		For TrueType fonts, it is returned by the
+		<a href="http://freetype.sourceforge.net/freetype2/docs/reference/ft2-base_interface.html#FT_Get_Postscript_Name">
+		FT_Get_Postscript_Name()</a>
 		function in FreeType. It will be used for displaying the font's name
 		for client applications.
 		\return	The base name of a font.
@@ -84,7 +86,7 @@ public :
 
 		-	It is the reference used to scale the outlines to a given text
 			dimension. For example, a size of 12pt at 300x300 dpi corresponds
-			to 12*300/72 = 50 pixels. This is the size the EM square would
+			to 12x300/72 = 50 pixels. This is the size the EM square would
 			appear on the output device if it was rendered directly. In other
 			words, scaling from grid units to pixels uses the formula:
 
@@ -103,7 +105,7 @@ public :
 	
 	/// Return the width of the glyph in PDF glyph unit.
 	/**	Call this function to convert the lengths in font unit to PDF glyph
-		unit. The PDF glyph unit is 1/1000 of user space, which is 1/72 inch.
+		unit. The PDF glyph unit is 1/1000 of user space unit, which is 1/72 inch.
 		I.e. if this function returns 72000, then it is one inch. This value
 		must be further multiplied by the font size in points to get the real
 		device-independent size.
diff --git a/libpdfdoc/include/font/Glyph.hh b/libpdfdoc/include/font/Glyph.hh
index 5ced50f..8b2fec3 100644
--- a/libpdfdoc/include/font/Glyph.hh
+++ b/libpdfdoc/include/font/Glyph.hh
@@ -63,7 +63,7 @@ public :
 
 	///	Decompose the glyph outline.
 	/**	This function walks through the glyph outline and decompose it into
-		individual segment and Bezier arcs. The caller will implement the
+		individual segment and Bezier arcs. The caller must implement the
 		Outline interface and the corresponding callback function in the Outline
 		interface will be called for each line segment and Bezier arcs in the
 		glyph.
diff --git a/libpdfdoc/include/font/Outline.hh b/libpdfdoc/include/font/Outline.hh
index 7209083..bd0cda5 100644
--- a/libpdfdoc/include/font/Outline.hh
+++ b/libpdfdoc/include/font/Outline.hh
@@ -35,7 +35,7 @@ namespace pdf {
 	back with the MoveTo(), LineTo() functions.
 	
 	All units are in font units. Transform font units to real units by calling
-	Font::Width(). 
+	Font::FromFontUnit().
 */
 class Outline
 {
diff --git a/libpdfdoc/include/graphics/Graphics.hh b/libpdfdoc/include/graphics/Graphics.hh
index d8987d3..99dcd40 100644
--- a/libpdfdoc/include/graphics/Graphics.hh
+++ b/libpdfdoc/include/graphics/Graphics.hh
@@ -44,10 +44,33 @@ class GraphicsState ;
 	The graphics objects represent visual elements that appears in the page.
 	These classes provide access to their content.
 	
+	\section 	gfx_coord	Coordinate Systems
+	
+	There are a number of coordinate system defined by the PDF specifications.
+	
+	\subsection	user_coord	User Space
+	
 	All graphics items in a PDF document uses the default coordinate called
 	"User Space". It is a devices independent unit. The default unit in users
 	space is point, which is 1/72 inch. In other words, the coordinate (72,72)
 	is corresponding to one inch right and inch up from the origin.
+	
+	\subsection	text_coord	Text Space
+	
+	The Text Space is the coordinate system for text rendering. The
+	transformation from user space to text space is defined a text matrix and
+	a few text states parameters. There are a number of operators to manipulate
+	the text matrix.
+	
+	\subsection	glyph_coord	Glyph Space
+	
+	Typically equals to 1/1000 units of text space, except for type 3 fonts.
+	
+	\subsection font_unit	Font Unit
+	
+	This one is not defined by the PDF specification. It is the unit used in
+	TrueType font and Type 1 fonts. Actually, the physical length of a font
+	unit depends on the font itself. Different fonts uses different units.
 */
 
 ///	brief description
diff --git a/libpdfdoc/include/libpdfdoc.hh b/libpdfdoc/include/libpdfdoc.hh
index b0e7460..360daea 100644
--- a/libpdfdoc/include/libpdfdoc.hh
+++ b/libpdfdoc/include/libpdfdoc.hh
@@ -29,8 +29,47 @@
 
 #define LIBPDFDOC_API 
 
-///	main namespace for libpdfdoc
-/**	This namespace contains almost everything in libpdfdoc.
+/**	\mainpage	libpdfdoc Library Documentation
+
+	libpdfdoc is a library for reading and writing PDF files. It is part of the
+	<a href="https://sourceforge.net/apps/trac/libpdfxx/wiki/WikiStart">libpdf++
+	</a> project. This section will describe how to write a simplest "Hello
+	world" program with libpdfdoc.
+
+	Let's start with the following code:
+
+\code
+pdf::Doc *doc = pdf::CreateDoc( ) ;
+pdf::Page *p = doc->AppendPage( ) ;
+pdf::Font *f = doc->CreateSimpleFont( "Arial" ) ;
+
+pdf::PageContent *c = p->GetContent( ) ;
+pdf::Text *t = c->AddText( 12.0, f ) ;
+t->AddLine( 100, 100, L"Hello world!" ) ;
+
+doc->Write( "helloworld.pdf" ) ;
+delete doc ;
+\endcode
+
+	The first line creates a PDF document. The CreateDoc() function will
+	create a Doc object, which represents a PDF document. The Doc object
+	provides functions to access the document content. It has member functions
+	to get the individual pages of the document. The document object has
+	ownership over all objects associate with it, including the pages, fonts and
+	visual elements. Therefore there is no need to delete these objects.
+	
+	The second line call pdf::Doc::AppendPage() to insert a new page at the end
+	of the document.
+	
+	\section	links	Links
+	
+	- <a href="http://sourceforge.net/apps/trac/libpdfxx/wiki/WikiStart">
+	libpdf++ Project Homepage</a>
+	- <a href="http://gitorious.org/libpdfxx">Gitorious hosted repository</a>
+*/
+
+///	Main namespace for libpdfdoc
+/**	This namespace contains almost everything in libpdfdoc and pdfedit.
 */
 namespace pdf {
 
-- 
1.6.6


From 15d47680a79c6fd6aef8a4a47c52331299026777 Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sat, 20 Feb 2010 14:19:43 +0000
Subject: [PATCH 07/13] use content stream for decoding page content

---
 libpdfdoc/src/page/ContentStream.cc |   23 +++++---
 libpdfdoc/src/page/ContentStream.hh |    2 +
 libpdfdoc/src/page/RealContent.cc   |  101 -----------------------------------
 libpdfdoc/src/page/RealContent.hh   |   41 ++-------------
 4 files changed, 20 insertions(+), 147 deletions(-)

diff --git a/libpdfdoc/src/page/ContentStream.cc b/libpdfdoc/src/page/ContentStream.cc
index 56bd857..48ffa78 100644
--- a/libpdfdoc/src/page/ContentStream.cc
+++ b/libpdfdoc/src/page/ContentStream.cc
@@ -130,6 +130,7 @@ std::cout << std::endl ;
 //					gstate,
 //					current,
 //					res ) ;
+				ProcessCommand( cmd, args.empty() ? 0 : &args[0], args.size() );
 
 				args.clear( ) ;
 			}
@@ -144,17 +145,16 @@ void ContentStream::ProcessCommand(
 	Object 			*args,
 	std::size_t 	count )
 {
-	if ( m_current != 0 )
-		m_current->OnCommand( cmd, args, count, m_res ) ;
-	else
+	HandlerMap::Map::const_iterator i = HandlerMap::m_map.find( cmd ) ;
+	if ( i != HandlerMap::m_map.end() )
 	{
-		HandlerMap::Map::const_iterator i = HandlerMap::m_map.find( cmd ) ;
-		if ( i != HandlerMap::m_map.end() )
-		{
-			PDF_ASSERT( i->second != 0 ) ;
-			(this->*(i->second))( args, count ) ;
-		}
+		PDF_ASSERT( i->second != 0 ) ;
+		(this->*(i->second))( args, count ) ;
 	}
+	else if ( m_current != 0 )
+		m_current->OnCommand( cmd, args, count, m_res ) ;
+	else
+		m_state.OnCommand( cmd, args, count, m_res ) ;
 }
 
 void ContentStream::OnBT( Object *, std::size_t )
@@ -186,4 +186,9 @@ void ContentStream::Onq( Object *args, std::size_t count )
 {
 }
 
+void ContentStream::SwapGfxObj( std::vector<Graphics*>& gfxs )
+{
+	m_gfx.swap( gfxs ) ;
+}
+
 } // end of namespace
diff --git a/libpdfdoc/src/page/ContentStream.hh b/libpdfdoc/src/page/ContentStream.hh
index a68045b..1d0d697 100644
--- a/libpdfdoc/src/page/ContentStream.hh
+++ b/libpdfdoc/src/page/ContentStream.hh
@@ -53,6 +53,8 @@ public :
 
 	void Decode( ) ;
 
+	void SwapGfxObj( std::vector<Graphics*>& gfxs ) ;
+
 private :
 	struct HandlerMap ;
 	
diff --git a/libpdfdoc/src/page/RealContent.cc b/libpdfdoc/src/page/RealContent.cc
index 9790a8e..f93b59d 100644
--- a/libpdfdoc/src/page/RealContent.cc
+++ b/libpdfdoc/src/page/RealContent.cc
@@ -53,107 +53,6 @@ void RealContent::Add( Graphics *gfx )
 	assert( gfx != 0 ) ;
 	m_gfx.push_back( gfx ) ;
 }
-
-///	Decode the page contents.
-/**	This function will decode the content stream of the page and create
-	Graphics objects. The newly created Graphics will be stored in the
-	vector in the Content object.
-*/
-void RealContent::Load( Stream& str, Resources *res )
-{
-	// rewind to stream start for reading
-	str.Rewind( ) ;
-	
-//	std::ostringstream ss ;
-//	str.CopyData( ss.rdbuf() ) ;
-//	std::cout << ss.str() << std::endl ;
-//	str.Rewind() ;
-	
-	std::istream s( str.InStreamBuf() ) ;
-	TokenSrc src( s ) ;
-	std::vector<Object> args ;
-
-	GraphicsState	gstate ;
-
-	Graphics *current = 0 ;
-
-	while ( true )
-	{
-		Token  cmd ;
-		Object obj ;
-
-		if ( src >> obj )
-		{
-			// swapping is faster
-			args.push_back( Object() ) ;
-			obj.Swap( args.back() ) ;
-		}
-		
-		// if it is not an object, then it should be a command operator
-		else
-		{
-			src.ResetState( ) ;
-			if ( src >> cmd )
-			{
-/*std::cout << cmd.Get() << " " ;
-std::copy( args.begin(), args.end(), std::ostream_iterator<Object>( std::cout, " " ) ) ;
-std::cout << std::endl ;
-*/
-
-				current = ProcessCommand(
-					cmd,
-					args.empty() ? 0 : &args[0],	// don't touch args[0]
-					args.size(),					// if empty.
-					gstate,
-					current,
-					res ) ;
-
-				args.clear( ) ;
-			}
-			else
-				break ;
-		}
-	}
-}
-
-Graphics* RealContent::ProcessCommand(
-	const Token& 	cmd,
-	Object 			*args,
-	std::size_t 	count,
-	GraphicsState&	gstate,
-	Graphics		*gfx,
-	Resources 		*res  )
-{
-	assert( count > 0 || args == 0 ) ;
-	
-
-	if ( cmd == Token("BT") && gfx == 0 )
-	{
-		gfx = new RealText( gstate ) ;
-	}
-	else if ( cmd == Token("ET") && gfx != 0 )
-	{
-		gstate = gfx->GetState( ) ;
-	
-		m_gfx.push_back( gfx ) ;
-		gfx = 0 ;
-	}
-	else if ( gfx != 0 )
-	{
-		gfx->OnCommand( cmd, args, count, res ) ;
-	}
-	
-	// page description level. this is the only place where the special
-	// graphics state operators are allowed. these will change the current
-	// transformation matrix (CTM).
-	else
-	{
-		gstate.OnCommand( cmd, args, count, res ) ;
-	}
-	
-	return gfx ;
-}
-
 bool RealContent::IsEmpty( ) const
 {
 	return m_gfx.empty() ;
diff --git a/libpdfdoc/src/page/RealContent.hh b/libpdfdoc/src/page/RealContent.hh
index 96e3363..3a036d5 100644
--- a/libpdfdoc/src/page/RealContent.hh
+++ b/libpdfdoc/src/page/RealContent.hh
@@ -27,18 +27,15 @@
 #define __PDF_REALCONTENT_HH_EADER_INCLUDED__
 
 #include "page/PageContent.hh"
+#include "page/ContentStream.hh"
 
 #include <vector>
 
 namespace pdf {
 
 class Graphics ;
-class Object ;
 class Resources ;
 class Stream ;
-class Text ;
-class GraphicsState ;
-class Token ;
 
 ///	brief description
 /**	The RealContent class represents
@@ -61,8 +58,9 @@ public :
 	template <typename InputIt>
 	void Load( InputIt first, InputIt last, Resources *res )
 	{
-		while ( first != last )
-			Load( *first++, res ) ;
+		ContentStream cs( first, last, res ) ;
+		cs.Decode( ) ;
+		cs.SwapGfxObj( m_gfx ) ;
 	}
 
 	void Write( Stream& str, const Resources *res ) const ;
@@ -70,37 +68,6 @@ public :
 	void Clear( ) ;
 
 private :
-	void Load( Stream& str, Resources *res ) ;
-
-private :
-	/// This enum denotes the state of decoding graphics objects.
-	enum OperatorState
-	{
-		/// In the page description level, all graphics states operators
-		/// are allowed.
-		page_description_level,
-		
-		/// Inside a text object only general graphics states, colour, text
-		/// states and text positioning and showing operators are allowed.
-		text_object,
-		
-		/// Only path construction operators are allowed in path objects.
-		path_object,
-		
-		
-		clipping_path_object,
-		inline_image_object,
-	} ;
-
-	Graphics* ProcessCommand(
-		const Token& 	cmd,
-		Object 			*args,
-		std::size_t 	count,
-		GraphicsState&	tstate,
-		Graphics		*gfx,
-		Resources 		*res ) ;
-
-private :
 	std::vector<Graphics*> m_gfx ;
 } ;
 
-- 
1.6.6


From d5bc7534a15b173740413129a7de94c3696e408b Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sat, 20 Feb 2010 15:58:37 +0000
Subject: [PATCH 08/13] fixed a bug on the Td and TD commands

---
 libpdfdoc/src/graphics/RealText.cc  |   10 ++++------
 libpdfdoc/src/page/ContentStream.cc |   31 ++++++++++++++++---------------
 libpdfdoc/src/page/ContentStream.hh |   13 +++++++++++--
 3 files changed, 31 insertions(+), 23 deletions(-)

diff --git a/libpdfdoc/src/graphics/RealText.cc b/libpdfdoc/src/graphics/RealText.cc
index 4ad021f..26fd703 100644
--- a/libpdfdoc/src/graphics/RealText.cc
+++ b/libpdfdoc/src/graphics/RealText.cc
@@ -227,9 +227,8 @@ void RealText::OnTd( Object* args, std::size_t count, const Resources* )
 {
 	if ( count >= 2 )
 	{
-		m_line_mat.Dx( m_line_mat.Dx() + args[0].To<double>() ) ;
-		m_line_mat.Dy( m_line_mat.Dy() + args[1].To<double>() ) ;
-		m_text_mat = m_line_mat ;
+		m_text_mat = m_line_mat =
+			m_line_mat * Matrix( 1, 0, 0, 1, args[0], args[1] ) ;
 
 		AddLine( TextLine( m_state, m_line_mat ) ) ;
 	}
@@ -243,9 +242,8 @@ void RealText::OnTD( Object* args, std::size_t count, const Resources *res )
 		double	ty	= args[1] ;
 		m_state.GetTextState().SetLeading( -ty ) ;
 		
-		m_line_mat.Dx( m_line_mat.Dx() + args[0].To<double>() ) ;
-		m_line_mat.Dy( m_line_mat.Dy() + args[1].To<double>() ) ;
-		m_text_mat = m_line_mat ;
+		m_text_mat = m_line_mat =
+			m_line_mat * Matrix( 1, 0, 0, 1, args[0], args[1] ) ;
 		
 		AddLine( TextLine( m_state, m_line_mat ) ) ;
 	}
diff --git a/libpdfdoc/src/page/ContentStream.cc b/libpdfdoc/src/page/ContentStream.cc
index 48ffa78..6e570fb 100644
--- a/libpdfdoc/src/page/ContentStream.cc
+++ b/libpdfdoc/src/page/ContentStream.cc
@@ -39,6 +39,7 @@
 #include <boost/bind.hpp>
 
 #include <algorithm>
+#include <iostream>
 
 namespace pdf {
 
@@ -89,10 +90,10 @@ void ContentStream::Decode( Stream& str )
 	// rewind to stream start for reading
 	str.Rewind( ) ;
 	
-//	std::ostringstream ss ;
-//	str.CopyData( ss.rdbuf() ) ;
-//	std::cout << ss.str() << std::endl ;
-//	str.Rewind() ;
+std::ostringstream ss ;
+str.CopyData( ss.rdbuf() ) ;
+std::cout << ss.str() << std::endl ;
+str.Rewind() ;
 	
 	std::istream s( str.InStreamBuf() ) ;
 	TokenSrc src( s ) ;
@@ -122,14 +123,6 @@ void ContentStream::Decode( Stream& str )
 std::copy( args.begin(), args.end(), std::ostream_iterator<Object>( std::cout, " " ) ) ;
 std::cout << std::endl ;
 */
-
-//				current = ProcessCommand(
-//					cmd,
-//					args.empty() ? 0 : &args[0],	// don't touch args[0]
-//					args.size(),					// if empty.
-//					gstate,
-//					current,
-//					res ) ;
 				ProcessCommand( cmd, args.empty() ? 0 : &args[0], args.size() );
 
 				args.clear( ) ;
@@ -154,20 +147,20 @@ void ContentStream::ProcessCommand(
 	else if ( m_current != 0 )
 		m_current->OnCommand( cmd, args, count, m_res ) ;
 	else
-		m_state.OnCommand( cmd, args, count, m_res ) ;
+		m_state.gs.OnCommand( cmd, args, count, m_res ) ;
 }
 
 void ContentStream::OnBT( Object *, std::size_t )
 {
 	if ( m_current == 0 )
-		m_current = new RealText( m_state ) ;
+		m_current = new RealText( m_state.gs ) ;
 }
 
 void ContentStream::OnET( Object *, std::size_t )
 {
 	if ( m_current != 0 )
 	{
-		m_state = m_current->GetState( ) ;
+		m_state.gs = m_current->GetState( ) ;
 		
 		m_gfx.push_back( m_current ) ;
 		m_current = 0 ;
@@ -176,14 +169,22 @@ void ContentStream::OnET( Object *, std::size_t )
 
 void ContentStream::Oncm( Object *args, std::size_t count )
 {
+	if ( count >= 6 )
+	{
+		m_state.ctm = Matrix(
+			args[0], args[1], args[2], args[3], args[4], args[5] ) ;
+	}
 }
 
 void ContentStream::OnQ( Object *args, std::size_t count )
 {
+	m_state = m_state_stack.top( ) ;
+	m_state_stack.pop( ) ;
 }
 
 void ContentStream::Onq( Object *args, std::size_t count )
 {
+	m_state_stack.push( m_state ) ;
 }
 
 void ContentStream::SwapGfxObj( std::vector<Graphics*>& gfxs )
diff --git a/libpdfdoc/src/page/ContentStream.hh b/libpdfdoc/src/page/ContentStream.hh
index 1d0d697..a7da65a 100644
--- a/libpdfdoc/src/page/ContentStream.hh
+++ b/libpdfdoc/src/page/ContentStream.hh
@@ -28,7 +28,9 @@
 
 #include "graphics/GraphicsState.hh"
 #include "stream/Stream.hh"
+#include "util/Matrix.hh"
 
+#include <stack>
 #include <vector>
 
 namespace pdf {
@@ -76,10 +78,17 @@ private :
 	std::vector<Graphics*>	m_gfx ;
 	const Resources			*m_res ;
 
+	/// all graphics states
+	struct State
+	{
+		GraphicsState	gs ;
+		Matrix			ctm ;
+	} m_state ;
+
 	//@{
 	/// Context information for decoding the graphics objects
-	Graphics				*m_current ;
-	GraphicsState			m_state ;
+	Graphics			*m_current ;
+	std::stack<State>	m_state_stack ;
 	//@}
 } ;
 
-- 
1.6.6


From 818e86fe5dee69c95e015d30f808793ab9b62780 Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sat, 20 Feb 2010 16:59:02 +0000
Subject: [PATCH 09/13] seems like Td will scale by Tm also

---
 libpdfdoc/src/graphics/RealText.cc |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/libpdfdoc/src/graphics/RealText.cc b/libpdfdoc/src/graphics/RealText.cc
index 26fd703..5053cd0 100644
--- a/libpdfdoc/src/graphics/RealText.cc
+++ b/libpdfdoc/src/graphics/RealText.cc
@@ -243,7 +243,9 @@ void RealText::OnTD( Object* args, std::size_t count, const Resources *res )
 		m_state.GetTextState().SetLeading( -ty ) ;
 		
 		m_text_mat = m_line_mat =
-			m_line_mat * Matrix( 1, 0, 0, 1, args[0], args[1] ) ;
+			m_line_mat * Matrix( 1, 0, 0, 1,
+				args[0].To<double>() * m_line_mat.M11(),
+				args[1].To<double>() * m_line_mat.M22() ) ;
 		
 		AddLine( TextLine( m_state, m_line_mat ) ) ;
 	}
-- 
1.6.6


From 32178f6e02beb0f7bc542346f265aadc520d854f Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sat, 20 Feb 2010 17:06:42 +0000
Subject: [PATCH 10/13] trying to separate xy offset with text matrix like xpdf

---
 libpdfdoc/include/graphics/TextLine.hh  |    7 +++++++
 libpdfdoc/src/graphics/RealText.cc      |   14 +++++++-------
 libpdfdoc/src/graphics/TextLine.cc      |   19 ++++++++++++++++---
 libpdfdoc/test/graphics/RealTextTest.cc |    2 +-
 libpdfdoc/test/graphics/TextLineTest.cc |    2 +-
 libpdfdoc/test/page/RealContentTest.cc  |    6 +++---
 libpdfdoc/test/page/RealPageTest.cc     |    8 ++++----
 pdfedit/src/GlyphGroup.cc               |    2 +-
 8 files changed, 40 insertions(+), 20 deletions(-)

diff --git a/libpdfdoc/include/graphics/TextLine.hh b/libpdfdoc/include/graphics/TextLine.hh
index 2d415c7..5a37a1b 100644
--- a/libpdfdoc/include/graphics/TextLine.hh
+++ b/libpdfdoc/include/graphics/TextLine.hh
@@ -54,12 +54,17 @@ class LIBPDFDOC_API TextLine
 {
 public :
 	explicit TextLine(
+		double	xpos = 0, double ypos = 0,
+		
 		const GraphicsState& 	state		= GraphicsState(),		
 		const Matrix&			transform	= Matrix(),
 		const std::wstring&		text		= std::wstring() ) ;
 
 	// uses default generated copy constructor
 
+	double XPos( ) const ;
+	double YPos( ) const ;
+
 	const Matrix& Transform() const ;
 	void SetTransform( const Matrix& t ) ;
 	bool IsEmpty( ) const ;
@@ -102,6 +107,8 @@ private :
 	std::ostream& PrintText( std::ostream& os ) const ;
 
 private :
+	double	m_xpos, m_ypos ;
+
 	/// The text matrix.
 	Matrix			m_trans ;
 	
diff --git a/libpdfdoc/src/graphics/RealText.cc b/libpdfdoc/src/graphics/RealText.cc
index 5053cd0..955eef6 100644
--- a/libpdfdoc/src/graphics/RealText.cc
+++ b/libpdfdoc/src/graphics/RealText.cc
@@ -80,7 +80,7 @@ const RealText::HandlerMap::Map RealText::HandlerMap::m_map(
 /**	constructor
 */
 RealText::RealText( const GraphicsState& gs )
-	: m_lines( 1, TextLine( gs, Matrix() ) ),
+	: m_lines( 1, TextLine( 0, 0, gs, Matrix() ) ),
 	  m_state( gs )
 {
 }
@@ -159,7 +159,7 @@ void RealText::OnCommand(
 			if ( current.IsEmpty() )
 				current.SetFormat( m_state ) ;
 			else
-				m_lines.push_back( TextLine( m_state, m_text_mat ) ) ;
+				m_lines.push_back( TextLine( 0, 0, m_state, m_text_mat ) ) ;
 		}
 	}
 }
@@ -177,7 +177,7 @@ void RealText::AddLine( const TextLine& line )
 
 void RealText::AddLine( double x, double y, const std::wstring& text )
 {
-	TextLine line( m_state, Matrix( 1,0,0,1, x, y ) ) ;
+	TextLine line( 0, 0, m_state, Matrix( 1,0,0,1, x, y ) ) ;
 	line.AppendText( text ) ;
 	return AddLine( line ) ;
 }
@@ -230,7 +230,7 @@ void RealText::OnTd( Object* args, std::size_t count, const Resources* )
 		m_text_mat = m_line_mat =
 			m_line_mat * Matrix( 1, 0, 0, 1, args[0], args[1] ) ;
 
-		AddLine( TextLine( m_state, m_line_mat ) ) ;
+		AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
 	}
 }
 
@@ -247,7 +247,7 @@ void RealText::OnTD( Object* args, std::size_t count, const Resources *res )
 				args[0].To<double>() * m_line_mat.M11(),
 				args[1].To<double>() * m_line_mat.M22() ) ;
 		
-		AddLine( TextLine( m_state, m_line_mat ) ) ;
+		AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
 	}
 }
 
@@ -260,7 +260,7 @@ void RealText::OnTm( Object* args, std::size_t count, const Resources* )
 		m_text_mat = m_line_mat = Matrix(
 			args[0], args[1], args[2], args[3], args[4], args[5] ) ;
 		
-		AddLine( TextLine( m_state, m_line_mat ) ) ;
+		AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
 	}
 }
 
@@ -269,7 +269,7 @@ void RealText::OnTstar( Object* , std::size_t , const Resources * )
 	m_line_mat.Dy( m_line_mat.Dy() -m_state.GetTextState().Leading() ) ;
 	m_text_mat = m_line_mat ;
 	
-	AddLine( TextLine( m_state, m_line_mat ) ) ;
+	AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
 }
 
 ///	Shows a Text string
diff --git a/libpdfdoc/src/graphics/TextLine.cc b/libpdfdoc/src/graphics/TextLine.cc
index 5f87dbd..d50790a 100644
--- a/libpdfdoc/src/graphics/TextLine.cc
+++ b/libpdfdoc/src/graphics/TextLine.cc
@@ -54,15 +54,28 @@ namespace pdf {
 
 ///	constructor
 TextLine::TextLine(
+	double xpos, double ypos,
 	const GraphicsState& 	state,
 	const Matrix& 			transform,
 	const std::wstring&		text )
-    : m_trans( transform ),
-      m_state( state ),
-      m_text( text )
+    : m_xpos( xpos )
+    , m_ypos( ypos )
+    , m_trans( transform )
+    , m_state( state )
+    , m_text( text )
 {
 }
 
+double TextLine::XPos( ) const
+{
+	return m_xpos ;
+}
+
+double TextLine::YPos( ) const
+{
+	return m_ypos ;
+}
+
 const Matrix& TextLine::Transform() const
 {
 	return m_trans ;
diff --git a/libpdfdoc/test/graphics/RealTextTest.cc b/libpdfdoc/test/graphics/RealTextTest.cc
index c31f4e4..afc76c6 100644
--- a/libpdfdoc/test/graphics/RealTextTest.cc
+++ b/libpdfdoc/test/graphics/RealTextTest.cc
@@ -81,7 +81,7 @@ void RealTextTest::TestTdCmd( )
 	PDFUT_ASSERT_EQUAL( t.front().Transform(), Matrix(1,0,0,1,400,1100) ) ;
 	
 	RealText exp( gs ) ;
-	exp.back() = TextLine( gs, Matrix(1,0,0,1,400,1100) ) ;
+	exp.back() = TextLine( 0, 0, gs, Matrix(1,0,0,1,400,1100) ) ;
 	PDFUT_ASSERT_EQUAL( t, exp ) ;
 }
 
diff --git a/libpdfdoc/test/graphics/TextLineTest.cc b/libpdfdoc/test/graphics/TextLineTest.cc
index 3f33735..364ace3 100644
--- a/libpdfdoc/test/graphics/TextLineTest.cc
+++ b/libpdfdoc/test/graphics/TextLineTest.cc
@@ -54,7 +54,7 @@ void TextLineTest::TestPrint( )
 	Name fname = res.AddFont( &font ) ;
 	
 	TextState ts( 12.0, &font ) ;
-	TextLine subject( (GraphicsState(ts)), (Matrix()) ) ;
+	TextLine subject( 0, 0, (GraphicsState(ts)), (Matrix()) ) ;
 	subject.AppendText( L"hello" ) ;
 	subject.AppendSpace( 100 ) ;
 	subject.AppendText( L"world" ) ;
diff --git a/libpdfdoc/test/page/RealContentTest.cc b/libpdfdoc/test/page/RealContentTest.cc
index 7ace878..abf9932 100644
--- a/libpdfdoc/test/page/RealContentTest.cc
+++ b/libpdfdoc/test/page/RealContentTest.cc
@@ -62,13 +62,13 @@ void RealContentTest::TestWrite( )
 	
 	Text *t = subject.AddText( ts ) ;
 	Matrix tm( 1,0,0,1, 100, 200 ) ;
-	TextLine line( (GraphicsState(ts)), tm ) ;
+	TextLine line( 0, 0, (GraphicsState(ts)), tm ) ;
 	line.AppendText( L"Hello World!\n" ) ;
 	line.AppendText( L"This is line 2\n" ) ;
 	t->AddLine( line ) ;
 
 	Matrix tm2( 1,0,0,1, 100, 400 ) ;
-	TextLine line2( (GraphicsState(ts)), tm2 ) ;
+	TextLine line2( 0, 0, (GraphicsState(ts)), tm2 ) ;
 	line2.AppendText( L"Hello World2!\n" ) ;
 	line2.AppendText( L"This is line 3\n" ) ;
 	t->AddLine( line2 ) ;
@@ -96,7 +96,7 @@ void RealContentTest::TestRead( )
 	TextState ts ;
 	ts.SetFont( 14.0, &font ) ;
 	Matrix tm( 1,0,0,1, 0, 0 ) ;
-	TextLine tl( (GraphicsState(ts)), tm ) ;
+	TextLine tl( 0, 0, (GraphicsState(ts)), tm ) ;
 	tl.AppendText( L"Hello World!" ) ;
 	
 	const Text *text = dynamic_cast<const Text*>( subject.Item(0) ) ;
diff --git a/libpdfdoc/test/page/RealPageTest.cc b/libpdfdoc/test/page/RealPageTest.cc
index 33320d0..8b6e97c 100644
--- a/libpdfdoc/test/page/RealPageTest.cc
+++ b/libpdfdoc/test/page/RealPageTest.cc
@@ -132,11 +132,11 @@ void RealPageTest::TestWrite( )
 	pdf::PageContent *c = p->GetContent( ) ;
 	pdf::Text *t = c->AddText( ts ) ;
 	
-	pdf::TextLine line1( (GraphicsState(ts)), pdf::Matrix(1,0,0,1, 120, 300) ) ;
+	pdf::TextLine line1( 0, 0, (GraphicsState(ts)), pdf::Matrix(1,0,0,1, 120, 300) ) ;
 	line1.AppendText( L"This is a line" ) ;
 	t->AddLine( line1 ) ;
 
-	pdf::TextLine line2( (GraphicsState(ts)), pdf::Matrix(1,0,0,1, 120, 400) ) ;
+	pdf::TextLine line2( 0, 0, (GraphicsState(ts)), pdf::Matrix(1,0,0,1, 120, 400) ) ;
 	line2.AppendText( L"This is another line" ) ;
 	t->AddLine( line2 ) ;
 
@@ -171,11 +171,11 @@ void RealPageTest::TestDecode( )
 	pdf::PageContent *c = p->GetContent( ) ;
 	pdf::Text *t = c->AddText( ts ) ;
 	
-	pdf::TextLine line1( (GraphicsState(ts)), pdf::Matrix(1,0,0,1, 120, 300) ) ;
+	pdf::TextLine line1( 0, 0, (GraphicsState(ts)), pdf::Matrix(1,0,0,1, 120, 300) ) ;
 	line1.AppendText( L"This is a line" ) ;
 	t->AddLine( line1 ) ;
 
-	pdf::TextLine line2( (GraphicsState(ts)), pdf::Matrix(1,0,0,1, 120, 400) ) ;
+	pdf::TextLine line2( 0, 0, (GraphicsState(ts)), pdf::Matrix(1,0,0,1, 120, 400) ) ;
 	line2.AppendText( L"This is another line" ) ;
 	t->AddLine( line2 ) ;
 	
diff --git a/pdfedit/src/GlyphGroup.cc b/pdfedit/src/GlyphGroup.cc
index 6391bf3..5dc8c5a 100644
--- a/pdfedit/src/GlyphGroup.cc
+++ b/pdfedit/src/GlyphGroup.cc
@@ -83,7 +83,7 @@ QString GlyphGroup::Text( ) const
 
 TextLine GlyphGroup::GetLine( ) const
 {
-	TextLine line( m_state, FromQtMatrix( sceneTransform( ) ) ) ;
+	TextLine line( 0, 0, m_state, FromQtMatrix( sceneTransform( ) ) ) ;
 	line.AppendText( ToWStr(m_text) ) ;
 	return line ; 
 }
-- 
1.6.6


From 458b03e077b8fc9fb272251e94e062f5f25f2e79 Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sat, 20 Feb 2010 17:38:32 +0000
Subject: [PATCH 11/13] will remove line matrix

---
 libpdfdoc/src/graphics/RealText.cc |   36 +++++++++++++++++++++++++++---------
 libpdfdoc/src/graphics/RealText.hh |    7 ++-----
 2 files changed, 29 insertions(+), 14 deletions(-)

diff --git a/libpdfdoc/src/graphics/RealText.cc b/libpdfdoc/src/graphics/RealText.cc
index 955eef6..b9be7d3 100644
--- a/libpdfdoc/src/graphics/RealText.cc
+++ b/libpdfdoc/src/graphics/RealText.cc
@@ -80,8 +80,11 @@ const RealText::HandlerMap::Map RealText::HandlerMap::m_map(
 /**	constructor
 */
 RealText::RealText( const GraphicsState& gs )
-	: m_lines( 1, TextLine( 0, 0, gs, Matrix() ) ),
-	  m_state( gs )
+	: m_lines( 1, TextLine( 0, 0, gs, Matrix() ) )
+	, m_state( gs )
+	, m_dx( 0 )
+	, m_dy( 0 )
+	, m_offset( 0 )
 {
 }
 
@@ -159,7 +162,7 @@ void RealText::OnCommand(
 			if ( current.IsEmpty() )
 				current.SetFormat( m_state ) ;
 			else
-				m_lines.push_back( TextLine( 0, 0, m_state, m_text_mat ) ) ;
+				m_lines.push_back( TextLine( m_dx + m_offset, m_dy, m_state, m_text_mat ) ) ;
 		}
 	}
 }
@@ -177,7 +180,7 @@ void RealText::AddLine( const TextLine& line )
 
 void RealText::AddLine( double x, double y, const std::wstring& text )
 {
-	TextLine line( 0, 0, m_state, Matrix( 1,0,0,1, x, y ) ) ;
+	TextLine line( x, y, m_state ) ;
 	line.AppendText( text ) ;
 	return AddLine( line ) ;
 }
@@ -229,8 +232,12 @@ void RealText::OnTd( Object* args, std::size_t count, const Resources* )
 	{
 		m_text_mat = m_line_mat =
 			m_line_mat * Matrix( 1, 0, 0, 1, args[0], args[1] ) ;
+		
+		m_dx += args[0].To<double>() ;
+		m_dy += args[1].To<double>() ;
+		m_offset = 0 ;
 
-		AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
+		AddLine( TextLine( m_dx, m_dy, m_state, m_line_mat ) ) ;
 	}
 }
 
@@ -247,7 +254,11 @@ void RealText::OnTD( Object* args, std::size_t count, const Resources *res )
 				args[0].To<double>() * m_line_mat.M11(),
 				args[1].To<double>() * m_line_mat.M22() ) ;
 		
-		AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
+		m_dx += args[0].To<double>() ;
+		m_dy += args[1].To<double>() ;
+		m_offset = 0 ;
+		
+		AddLine( TextLine( m_dx, m_dy, m_state, m_line_mat ) ) ;
 	}
 }
 
@@ -260,6 +271,8 @@ void RealText::OnTm( Object* args, std::size_t count, const Resources* )
 		m_text_mat = m_line_mat = Matrix(
 			args[0], args[1], args[2], args[3], args[4], args[5] ) ;
 		
+		m_offset = m_dx = m_dy = 0.0 ;
+		
 		AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
 	}
 }
@@ -269,7 +282,10 @@ void RealText::OnTstar( Object* , std::size_t , const Resources * )
 	m_line_mat.Dy( m_line_mat.Dy() -m_state.GetTextState().Leading() ) ;
 	m_text_mat = m_line_mat ;
 	
-	AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
+	m_dy -= m_state.GetTextState().Leading() ;
+	m_offset = 0 ;
+	
+	AddLine( TextLine( m_dx, m_dy, m_state, m_line_mat ) ) ;
 }
 
 ///	Shows a Text string
@@ -289,7 +305,8 @@ void RealText::OnTj( Object* args, std::size_t count, const Resources * )
 			
 			current.AppendText( ws ) ;
 			
-			m_text_mat.Dx( m_text_mat.Dx() + m_state.GetTextState().Width( ws ) ) ; 
+			m_text_mat.Dx( m_text_mat.Dx() + m_state.GetTextState().Width( ws ) ) ;
+			m_offset += m_state.GetTextState().Width( ws ) ;
 		}
 	}
 }
@@ -341,7 +358,8 @@ void RealText::OnTJ( Object* args, std::size_t count, const Resources *res )
 	
 	// TODO: depend on writing mode, advance horizonal or vertical
 	// assume vertical here.
-	m_text_mat.Dx( m_text_mat.Dx() + offset ) ; 
+	m_text_mat.Dx( m_text_mat.Dx() + offset ) ;
+	m_offset += offset ;
 }
 
 void RealText::OnSingleQuote( Object* args, std::size_t count, const Resources *res )
diff --git a/libpdfdoc/src/graphics/RealText.hh b/libpdfdoc/src/graphics/RealText.hh
index 06c7451..ba2de98 100644
--- a/libpdfdoc/src/graphics/RealText.hh
+++ b/libpdfdoc/src/graphics/RealText.hh
@@ -105,15 +105,12 @@ private :
 	GraphicsState	m_state ;
 	
 	///	Current text line matrix.
-	/**	This matrix is only affect by the Td/TD and Tm commands. It will be
-		changes when showing text.
-	*/
-	Matrix		m_line_mat ;
+	double		m_dx, m_dy, m_offset ;
 	
 	///	Current text matrix.
 	/**	This matrix is used to create new TextLine objects.
 	*/
-	Matrix		m_text_mat ;
+	Matrix		m_line_mat, m_text_mat ;
 } ;
 
 std::ostream& operator<<( std::ostream& os, const RealText& t ) ;
-- 
1.6.6


From b26bfcc36cd809b277034f5c1f0cff1eb6f16367 Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sat, 20 Feb 2010 18:19:28 +0000
Subject: [PATCH 12/13] separated Td and Tm, but still doesn't fix the problem

the problem may be elsewhere
---
 libpdfdoc/include/graphics/CharVisitor.hh |    3 +-
 libpdfdoc/src/graphics/RealText.cc        |   33 ++++++++++++++---------------
 libpdfdoc/src/graphics/RealText.hh        |    2 +-
 libpdfdoc/src/graphics/TextLine.cc        |   11 ++++++---
 pdfedit/src/GlyphGroup.cc                 |   11 ++++++++-
 pdfedit/src/GlyphGroup.hh                 |    2 +-
 6 files changed, 36 insertions(+), 26 deletions(-)

diff --git a/libpdfdoc/include/graphics/CharVisitor.hh b/libpdfdoc/include/graphics/CharVisitor.hh
index 8e1f9da..3c12384 100644
--- a/libpdfdoc/include/graphics/CharVisitor.hh
+++ b/libpdfdoc/include/graphics/CharVisitor.hh
@@ -54,7 +54,8 @@ public :
 	*/
 	virtual void OnChar(
 		wchar_t 			ch,
-		const Matrix&		m,
+//		const Matrix&		m,
+		double				offset,
 		const Glyph			*glyph,
 		const TextState&	state ) = 0 ;
 } ;
diff --git a/libpdfdoc/src/graphics/RealText.cc b/libpdfdoc/src/graphics/RealText.cc
index b9be7d3..4b278f4 100644
--- a/libpdfdoc/src/graphics/RealText.cc
+++ b/libpdfdoc/src/graphics/RealText.cc
@@ -180,7 +180,7 @@ void RealText::AddLine( const TextLine& line )
 
 void RealText::AddLine( double x, double y, const std::wstring& text )
 {
-	TextLine line( x, y, m_state ) ;
+	TextLine line( x, y, m_state, m_text_mat ) ;
 	line.AppendText( text ) ;
 	return AddLine( line ) ;
 }
@@ -230,35 +230,34 @@ void RealText::OnTd( Object* args, std::size_t count, const Resources* )
 {
 	if ( count >= 2 )
 	{
-		m_text_mat = m_line_mat =
-			m_line_mat * Matrix( 1, 0, 0, 1, args[0], args[1] ) ;
+//		m_text_mat = m_line_mat =
+//			m_line_mat * Matrix( 1, 0, 0, 1, args[0], args[1] ) ;
 		
 		m_dx += args[0].To<double>() ;
 		m_dy += args[1].To<double>() ;
 		m_offset = 0 ;
 
-		AddLine( TextLine( m_dx, m_dy, m_state, m_line_mat ) ) ;
+		AddLine( TextLine( m_dx, m_dy, m_state, m_text_mat ) ) ;
 	}
 }
 
 void RealText::OnTD( Object* args, std::size_t count, const Resources *res )
 {
-	
 	if ( count >= 2 )
 	{
 		double	ty	= args[1] ;
 		m_state.GetTextState().SetLeading( -ty ) ;
 		
-		m_text_mat = m_line_mat =
-			m_line_mat * Matrix( 1, 0, 0, 1,
-				args[0].To<double>() * m_line_mat.M11(),
-				args[1].To<double>() * m_line_mat.M22() ) ;
+//		m_text_mat = m_line_mat =
+//			m_line_mat * Matrix( 1, 0, 0, 1,
+//				args[0].To<double>() * m_line_mat.M11(),
+//				args[1].To<double>() * m_line_mat.M22() ) ;
 		
 		m_dx += args[0].To<double>() ;
 		m_dy += args[1].To<double>() ;
 		m_offset = 0 ;
 		
-		AddLine( TextLine( m_dx, m_dy, m_state, m_line_mat ) ) ;
+		AddLine( TextLine( m_dx, m_dy, m_state, m_text_mat ) ) ;
 	}
 }
 
@@ -268,24 +267,24 @@ void RealText::OnTm( Object* args, std::size_t count, const Resources* )
 	{
 		// unlike Td and TD, the Tm command will replace the current
 		// matrix.
-		m_text_mat = m_line_mat = Matrix(
+		m_text_mat = Matrix(
 			args[0], args[1], args[2], args[3], args[4], args[5] ) ;
 		
 		m_offset = m_dx = m_dy = 0.0 ;
 		
-		AddLine( TextLine( 0, 0, m_state, m_line_mat ) ) ;
+		AddLine( TextLine( 0, 0, m_state, m_text_mat ) ) ;
 	}
 }
 
 void RealText::OnTstar( Object* , std::size_t , const Resources * )
 {
-	m_line_mat.Dy( m_line_mat.Dy() -m_state.GetTextState().Leading() ) ;
-	m_text_mat = m_line_mat ;
+//	m_line_mat.Dy( m_line_mat.Dy() -m_state.GetTextState().Leading() ) ;
+//	m_text_mat = m_line_mat ;
 	
 	m_dy -= m_state.GetTextState().Leading() ;
 	m_offset = 0 ;
 	
-	AddLine( TextLine( m_dx, m_dy, m_state, m_line_mat ) ) ;
+	AddLine( TextLine( m_dx, m_dy, m_state, m_text_mat ) ) ;
 }
 
 ///	Shows a Text string
@@ -305,7 +304,7 @@ void RealText::OnTj( Object* args, std::size_t count, const Resources * )
 			
 			current.AppendText( ws ) ;
 			
-			m_text_mat.Dx( m_text_mat.Dx() + m_state.GetTextState().Width( ws ) ) ;
+//			m_text_mat.Dx( m_text_mat.Dx() + m_state.GetTextState().Width( ws ) ) ;
 			m_offset += m_state.GetTextState().Width( ws ) ;
 		}
 	}
@@ -358,7 +357,7 @@ void RealText::OnTJ( Object* args, std::size_t count, const Resources *res )
 	
 	// TODO: depend on writing mode, advance horizonal or vertical
 	// assume vertical here.
-	m_text_mat.Dx( m_text_mat.Dx() + offset ) ;
+//	m_text_mat.Dx( m_text_mat.Dx() + offset ) ;
 	m_offset += offset ;
 }
 
diff --git a/libpdfdoc/src/graphics/RealText.hh b/libpdfdoc/src/graphics/RealText.hh
index ba2de98..6985604 100644
--- a/libpdfdoc/src/graphics/RealText.hh
+++ b/libpdfdoc/src/graphics/RealText.hh
@@ -110,7 +110,7 @@ private :
 	///	Current text matrix.
 	/**	This matrix is used to create new TextLine objects.
 	*/
-	Matrix		m_line_mat, m_text_mat ;
+	Matrix		m_text_mat ;
 } ;
 
 std::ostream& operator<<( std::ostream& os, const RealText& t ) ;
diff --git a/libpdfdoc/src/graphics/TextLine.cc b/libpdfdoc/src/graphics/TextLine.cc
index d50790a..8329fe6 100644
--- a/libpdfdoc/src/graphics/TextLine.cc
+++ b/libpdfdoc/src/graphics/TextLine.cc
@@ -210,7 +210,8 @@ double TextLine::Width( ) const
 
 void TextLine::VisitChars( CharVisitor *v ) const
 {
-	Matrix tm ;
+//	Matrix tm ;
+	double	offset = 0.0 ;
 	Font *font	= m_state.GetFont( ) ; 
 	PDF_ASSERT( font != 0 ) ;
 	
@@ -221,7 +222,8 @@ void TextLine::VisitChars( CharVisitor *v ) const
 		// has space?
 		if ( sp != m_space.end() && idx == sp->index )
 		{
-			tm.Dx( tm.Dx() - sp->width ) ;
+//			tm.Dx( tm.Dx() - sp->width ) ;
+			offset -= sp->width ;
 			++sp ;
 		}
 	
@@ -231,10 +233,11 @@ void TextLine::VisitChars( CharVisitor *v ) const
 
 		if ( glyph != 0 && glyph->IsOutline() )
 		{
-			v->OnChar( m_text[idx], tm, glyph, ts ) ;
+			v->OnChar( m_text[idx], offset, glyph, ts ) ;
 
 			// update X position
-			tm.Dx( tm.Dx() + glyph->AdvanceX() * ts.ScaleFactor() ) ;
+//			tm.Dx( tm.Dx() + glyph->AdvanceX() * ts.ScaleFactor() ) ;
+			offset += glyph->AdvanceX() * ts.ScaleFactor() ;
 		}
 		else
 		{
diff --git a/pdfedit/src/GlyphGroup.cc b/pdfedit/src/GlyphGroup.cc
index 5dc8c5a..7dec493 100644
--- a/pdfedit/src/GlyphGroup.cc
+++ b/pdfedit/src/GlyphGroup.cc
@@ -47,21 +47,28 @@ GlyphGroup::GlyphGroup( const TextLine& blk, QGraphicsItem *parent )
 	  m_state( blk.Format() )
 {
 	blk.VisitChars( this ) ;
+	
 	// setup flags
 	setFlags( ItemIsSelectable | ItemIsMovable ) ;
+
+	QTransform t = ToQtMatrix( blk.Transform() ) ;
+	setTransform( t ) ;
+	
+	QPointF pos( blk.XPos(), blk.YPos() ) ;
+	setPos( pos ) ;
 }
 
 void GlyphGroup::OnChar(
 	wchar_t 			ch,
-	const Matrix&		m,
+	double				offset,
 	const Glyph			*glyph,
 	const TextState&	state ) 
 {
 	GlyphGraphicsItem *item = new GlyphGraphicsItem( glyph ) ;
 
 	// scale font by their font size
-	item->setTransform( ToQtMatrix( m ) ) ;
 	item->scale( state.ScaleFactor(), state.ScaleFactor() ) ;
+	item->setPos( offset, 0 ) ;
 
 	addToGroup( item ) ;
 }
diff --git a/pdfedit/src/GlyphGroup.hh b/pdfedit/src/GlyphGroup.hh
index 1da31eb..cbfe2b1 100644
--- a/pdfedit/src/GlyphGroup.hh
+++ b/pdfedit/src/GlyphGroup.hh
@@ -46,7 +46,7 @@ public :
 
 	void OnChar(
 		wchar_t 			ch,
-		const Matrix&		m,
+		double				offset,
 		const Glyph			*glyph,
 		const TextState&	state ) ; 
 
-- 
1.6.6


From 7e604e6655ada2b11e5f53e1e20a8524130e9994 Mon Sep 17 00:00:00 2001
From: Matchman <match41@users.sourceforge.net>
Date: Sun, 21 Feb 2010 10:16:51 +0000
Subject: [PATCH 13/13] implemented proper transformation for glyph group rendering

---
 pdfedit/src/GlyphGroup.cc |   12 +++++-------
 pdfedit/src/GlyphGroup.hh |    1 +
 2 files changed, 6 insertions(+), 7 deletions(-)

diff --git a/pdfedit/src/GlyphGroup.cc b/pdfedit/src/GlyphGroup.cc
index 7dec493..9209470 100644
--- a/pdfedit/src/GlyphGroup.cc
+++ b/pdfedit/src/GlyphGroup.cc
@@ -42,9 +42,10 @@ namespace pdf {
 /**	constructor
 */
 GlyphGroup::GlyphGroup( const TextLine& blk, QGraphicsItem *parent )
-	: QGraphicsItemGroup( parent ),
-	  m_text( FromWStr(blk.Text()) ),
-	  m_state( blk.Format() )
+	: QGraphicsItemGroup( parent )
+	, m_text( FromWStr(blk.Text()) )
+	, m_state( blk.Format() )
+	, m_pos( blk.XPos(), blk.YPos() )
 {
 	blk.VisitChars( this ) ;
 	
@@ -53,9 +54,6 @@ GlyphGroup::GlyphGroup( const TextLine& blk, QGraphicsItem *parent )
 
 	QTransform t = ToQtMatrix( blk.Transform() ) ;
 	setTransform( t ) ;
-	
-	QPointF pos( blk.XPos(), blk.YPos() ) ;
-	setPos( pos ) ;
 }
 
 void GlyphGroup::OnChar(
@@ -67,8 +65,8 @@ void GlyphGroup::OnChar(
 	GlyphGraphicsItem *item = new GlyphGraphicsItem( glyph ) ;
 
 	// scale font by their font size
+	item->translate( m_pos.x() + offset, m_pos.y() ) ;
 	item->scale( state.ScaleFactor(), state.ScaleFactor() ) ;
-	item->setPos( offset, 0 ) ;
 
 	addToGroup( item ) ;
 }
diff --git a/pdfedit/src/GlyphGroup.hh b/pdfedit/src/GlyphGroup.hh
index cbfe2b1..79bba0c 100644
--- a/pdfedit/src/GlyphGroup.hh
+++ b/pdfedit/src/GlyphGroup.hh
@@ -63,6 +63,7 @@ public :
 private :
 	QString			m_text ;
 	GraphicsState	m_state ;
+	QPointF			m_pos ;
 } ;
 
 } // end of namespace
-- 
1.6.6

